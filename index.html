<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Internal Calculator - Contrive Interior &amp; Construction</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;family=Manrope:wght@500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    

    
    /* Remove number input spinners */
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    input[type="number"] {
      -moz-appearance: textfield;
      appearance: textfield;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1a1d29 0%, #0f1419 100%);
      color: #e8eaed;
      line-height: 1.6;
      transition: background 0.3s ease, color 0.3s ease;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* Light Mode */
    body.light-mode {
      background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
      color: #1a202c;
    }
    
    body.light-mode header {
      background: linear-gradient(135deg, #ffffff 0%, #f5f7fa 100%);
      border-bottom: 1px solid rgba(255, 138, 76, 0.2);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }
    
    body.light-mode .selection-screen {
      background: #e8ecf1;
    }
    
    body.light-mode .selection-box {
      background: linear-gradient(135deg, #ffffff 0%, #f5f7fa 100%);
      border: 1px solid rgba(255, 138, 76, 0.15);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    body.light-mode .selection-subtitle {
      color: #4b5563;
    }
    
    body.light-mode .project-type-btn {
      background: linear-gradient(135deg, #f5f7fa 0%, #ffffff 100%);
      border: 2px solid rgba(255, 138, 76, 0.25);
    }
    
    body.light-mode .project-meta {
      color: #6b7280;
    }
    
    body.light-mode .calculator-screen {
      background: #e8ecf1;
    }
    
    body.light-mode .project-header {
      background: linear-gradient(135deg, #ffffff 0%, #f5f7fa 100%);
      border: 1px solid rgba(255, 138, 76, 0.15);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }
    
    body.light-mode .change-project-btn {
      background: rgba(255, 138, 76, 0.1);
      border: 1px solid rgba(255, 138, 76, 0.25);
    }
    
    body.light-mode .input-section {
      background: linear-gradient(135deg, #ffffff 0%, #f5f7fa 100%);
      border: 1px solid rgba(255, 138, 76, 0.15);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }
    
    body.light-mode .input-group label {
      color: #4b5563;
    }
    
    body.light-mode .input-group input {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(255, 138, 76, 0.2);
      color: #1a202c;
    }
    
    body.light-mode .input-group input:focus {
      background: #ffffff;
    }
    
    body.light-mode .input-group small {
      color: #6b7280;
    }
    
    body.light-mode .toggle-label span {
      color: #374151;
    }
    
    body.light-mode .results-section {
      background: linear-gradient(135deg, #ffffff 0%, #f5f7fa 100%);
      border: 1px solid rgba(255, 138, 76, 0.15);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    body.light-mode .results-table td {
      color: #374151;
      border-bottom: 1px solid rgba(255, 138, 76, 0.1);
    }
    
    body.light-mode .rate-input {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 138, 76, 0.3);
      color: #1a202c;
    }
    
    body.light-mode .rate-input:focus {
      background: #ffffff;
    }
    
    body.light-mode .rate-input::placeholder {
      color: #9ca3af;
    }
    
    body.light-mode .results-table tfoot {
      background: rgba(255, 138, 76, 0.05);
    }
    
    body.light-mode footer {
      background: #ffffff;
      border-top: 1px solid rgba(255, 138, 76, 0.15);
    }
    
    body.light-mode .internal-wall-entry input {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(255, 138, 76, 0.2);
      color: #1a202c;
    }
    
    body.light-mode .internal-wall-entry input:focus {
      background: #ffffff;
    }
    
    body.light-mode select {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(255, 138, 76, 0.2);
      color: #1a202c;
    }
    
    body.light-mode select:focus {
      background: #ffffff;
      border-color: #ff8a4c;
      box-shadow: 0 0 0 3px rgba(255, 138, 76, 0.1);
      outline: none;
    }
    
    .app-container {
      width: 100%;
      min-height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    /* Header */
    header {
      background: linear-gradient(135deg, #252932 0%, #1a1d29 100%);
      color: white;
      padding: 2rem 2rem;
      border-bottom: 1px solid rgba(255, 138, 76, 0.15);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      text-align: center;
      position: relative;
    }
    
    .header-text {
      width: 100%;
    }
    
    .theme-toggle {
      position: absolute;
      top: 2rem;
      right: 2rem;
      background: rgba(255, 20, 147, 0.15);
      border: 2px solid rgba(255, 20, 147, 0.4);
      color: #ff1493;
      padding: 0.875rem 1.5rem;
      border-radius: 12px;
      font-size: 1rem;
      font-family: 'Inter', sans-serif;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 600;
      box-shadow: 0 0 20px rgba(255, 20, 147, 0.4), 0 0 40px rgba(255, 20, 147, 0.2);
      animation: pinkGlow 2s ease-in-out infinite;
      cursor: pointer;
    }
    
    @keyframes pinkGlow {
      0%, 100% {
        box-shadow: 0 0 20px rgba(255, 20, 147, 0.4), 0 0 40px rgba(255, 20, 147, 0.2);
        border-color: rgba(255, 20, 147, 0.4);
      }
      50% {
        box-shadow: 0 0 30px rgba(255, 20, 147, 0.6), 0 0 60px rgba(255, 20, 147, 0.4), 0 0 80px rgba(255, 20, 147, 0.2);
        border-color: rgba(255, 20, 147, 0.7);
      }
    }
    
    .theme-toggle:hover {
      background: rgba(255, 20, 147, 0.25);
      border-color: #ff1493;
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 0 35px rgba(255, 20, 147, 0.7), 0 0 70px rgba(255, 20, 147, 0.5), 0 0 100px rgba(255, 20, 147, 0.3);
    }
    
    .theme-toggle svg {
      width: 22px;
      height: 22px;
      filter: drop-shadow(0 0 4px rgba(255, 20, 147, 0.6));
    }
    
    h1 {
      font-size: 5.25rem;
      font-weight: 700;
      font-family: 'Manrope', -apple-system, BlinkMacSystemFont, sans-serif;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, #ff8a4c 0%, #ffad7a 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.25rem;
      animation: textGlow 3s ease-in-out infinite;
      transition: all 0.4s ease;
      display: inline-block;
    }
    
    h1:hover {
      transform: scale(1.05) rotate(-1deg);
      filter: drop-shadow(0 0 30px rgba(255, 138, 76, 0.9)) drop-shadow(0 0 60px rgba(255, 173, 122, 0.7));
      animation: intenseGlow 1s ease-in-out infinite;
    }
    
    @keyframes textGlow {
      0%, 100% {
        filter: drop-shadow(0 0 8px rgba(255, 138, 76, 0.4));
      }
      50% {
        filter: drop-shadow(0 0 20px rgba(255, 138, 76, 0.8)) drop-shadow(0 0 30px rgba(255, 173, 122, 0.6));
      }
    }
    
    @keyframes intenseGlow {
      0%, 100% {
        filter: drop-shadow(0 0 30px rgba(255, 138, 76, 0.9)) drop-shadow(0 0 60px rgba(255, 173, 122, 0.7));
      }
      50% {
        filter: drop-shadow(0 0 50px rgba(255, 138, 76, 1)) drop-shadow(0 0 90px rgba(255, 173, 122, 0.9));
      }
    }
    
    .subtitle {
      font-size: 0.875rem;
      color: #9ca3af;
      margin-top: 0.5rem;
      font-family: 'Inter', sans-serif;
      text-transform: none;
      letter-spacing: 0.3px;
      font-weight: 400;
      transition: all 0.3s ease;
    }
    
    .subtitle:hover {
      color: #ffad7a;
      transform: scale(1.02);
      text-shadow: 0 0 10px rgba(255, 173, 122, 0.5);
    }
    
    /* Project Type Selection Screen */
    .selection-screen {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      background: linear-gradient(135deg, #1a0a00 0%, #0a0a1a 25%, #001a0a 50%, #0a001a 75%, #1a0a00 100%);
      background-size: 400% 400%;
      animation: rotateGradient 20s ease infinite;
      position: relative;
      overflow: hidden;
    }
    
    .selection-screen::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at center, rgba(255, 138, 76, 0.3) 0%, rgba(255, 138, 76, 0.15) 20%, transparent 50%);
      animation: rotateGlow 15s linear infinite, glowPulse 4s ease-in-out infinite;
      pointer-events: none;
    }
    
    .selection-screen::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 30%, rgba(76, 159, 255, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(159, 76, 255, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 50% 50%, rgba(76, 255, 138, 0.1) 0%, transparent 50%);
      animation: floatGlow 20s ease-in-out infinite;
      pointer-events: none;
    }
    
    @keyframes rotateGradient {
      0% { background-position: 0% 50%; }
      25% { background-position: 50% 50%; }
      50% { background-position: 100% 50%; }
      75% { background-position: 50% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    @keyframes rotateGlow {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes glowPulse {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 0.8; }
    }
    
    @keyframes floatGlow {
      0%, 100% { 
        opacity: 0.5;
        transform: scale(1);
      }
      25% { 
        opacity: 0.8;
        transform: scale(1.1);
      }
      50% { 
        opacity: 0.6;
        transform: scale(0.95);
      }
      75% { 
        opacity: 0.9;
        transform: scale(1.05);
      }
    }
    
    .selection-box {
      background: linear-gradient(135deg, #252932 0%, #1a1d29 100%);
      padding: 3rem;
      border-radius: 24px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      max-width: 700px;
      width: 100%;
      border: 1px solid rgba(255, 138, 76, 0.12);
      position: relative;
      z-index: 1;
      backdrop-filter: blur(10px);
      animation: floatingBox 6s ease-in-out infinite;
    }
    
    @keyframes floatingBox {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-10px);
      }
    }
    
    .selection-box h2 {
      font-size: 2.25rem;
      margin-bottom: 0.5rem;
      font-family: 'Manrope', sans-serif;
      letter-spacing: -0.5px;
      font-weight: 700;
      background: linear-gradient(135deg, #ff8a4c 0%, #ffad7a 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      transition: all 0.3s ease;
    }
    
    .selection-box h2:hover {
      transform: scale(1.03);
      filter: drop-shadow(0 0 20px rgba(255, 138, 76, 0.8));
    }
    
    .selection-subtitle {
      color: #9ca3af;
      font-size: 0.9375rem;
      margin-bottom: 2rem;
      font-family: 'Inter', sans-serif;
      font-weight: 400;
    }
    
    .project-types {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
    
    .project-type-btn {
      background: #1a1d29;
      border: 2px solid rgba(255, 138, 76, 0.2);
      padding: 2rem 1.5rem;
      border-radius: 16px;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      font-size: 1.25rem;
      font-weight: 600;
      color: #ff8a4c;
      font-family: 'Manrope', sans-serif;
      letter-spacing: -0.3px;
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }
    
    .project-type-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      opacity: 0;
      transition: opacity 0.4s ease;
      z-index: 0;
    }
    
    .project-type-btn.aerocon::before {
      background: linear-gradient(135deg, rgba(255, 138, 76, 0.2) 0%, rgba(255, 100, 50, 0.3) 100%);
    }
    
    .project-type-btn.puff::before {
      background: linear-gradient(135deg, rgba(76, 159, 255, 0.2) 0%, rgba(50, 130, 255, 0.3) 100%);
    }
    
    .project-type-btn.container::before {
      background: linear-gradient(135deg, rgba(159, 76, 255, 0.2) 0%, rgba(130, 50, 255, 0.3) 100%);
    }
    
    .project-type-btn.shed::before {
      background: linear-gradient(135deg, rgba(76, 255, 138, 0.2) 0%, rgba(50, 255, 100, 0.3) 100%);
    }
    
    .project-type-btn > * {
      position: relative;
      z-index: 1;
    }
    
    .project-type-btn:hover::before {
      opacity: 1;
    }
    
    .project-type-btn:hover {
      border-color: currentColor;
      transform: translateY(-12px) scale(1.05);
      box-shadow: 0 20px 60px currentColor;
      background: #252932;
    }
    
    .project-type-btn.aerocon {
      color: #ff8a4c;
      border-color: rgba(255, 138, 76, 0.3);
    }
    
    .project-type-btn.aerocon:hover {
      border-color: #ff8a4c;
      box-shadow: 0 20px 60px rgba(255, 138, 76, 0.6);
      animation: pulseGlow 1.5s ease-in-out infinite;
    }
    
    .project-type-btn.puff {
      color: #4c9fff;
      border-color: rgba(76, 159, 255, 0.3);
    }
    
    .project-type-btn.puff:hover {
      border-color: #4c9fff;
      box-shadow: 0 20px 60px rgba(76, 159, 255, 0.6);
      animation: pulseGlow 1.5s ease-in-out infinite;
    }
    
    .project-type-btn.container {
      color: #9f4cff;
      border-color: rgba(159, 76, 255, 0.3);
    }
    
    .project-type-btn.container:hover {
      border-color: #9f4cff;
      box-shadow: 0 20px 60px rgba(159, 76, 255, 0.6);
      animation: pulseGlow 1.5s ease-in-out infinite;
    }
    
    .project-type-btn.shed {
      color: #4cff8a;
      border-color: rgba(76, 255, 138, 0.3);
    }
    
    .project-type-btn.shed:hover {
      border-color: #4cff8a;
      box-shadow: 0 20px 60px rgba(76, 255, 138, 0.6);
      animation: pulseGlow 1.5s ease-in-out infinite;
    }
    
    @keyframes pulseGlow {
      0%, 100% {
        filter: brightness(1);
      }
      50% {
        filter: brightness(1.3);
      }
    }
    
    .project-icon {
      margin-bottom: 0.75rem;
      display: flex;
      justify-content: center;
      transition: all 0.4s ease;
    }
    
    .project-type-btn:hover .project-icon {
      transform: scale(1.2) rotate(5deg);
      filter: drop-shadow(0 0 15px currentColor);
    }
    
    .project-meta {
      font-size: 0.75rem;
      color: #6b7280;
      font-family: 'Inter', sans-serif;
      margin-top: 0.5rem;
      font-weight: 400;
      letter-spacing: 0.2px;
      transition: all 0.3s ease;
    }
    
    .project-type-btn:hover .project-meta {
      color: currentColor;
      transform: scale(1.05);
    }
    
    /* Calculator Screen */
    .calculator-screen {
      display: none;
      flex: 1;
      padding: 2rem;
      background: linear-gradient(135deg, #0f1419 0%, #1a1d29 100%);
      transition: background 0.6s ease;
    }
    
    .calculator-screen.active {
      display: block;
    }
    
    .calculator-screen.aerocon-theme {
      background: linear-gradient(135deg, #1a0f0a 0%, #1a1410 50%, #0f1419 100%);
    }
    
    .calculator-screen.puff-theme {
      background: linear-gradient(135deg, #0a0f1a 0%, #0f1419 50%, #0a141a 100%);
    }
    
    .calculator-screen.container-theme {
      background: linear-gradient(135deg, #140a1a 0%, #1a0f1a 50%, #0f1419 100%);
    }
    
    .calculator-screen.shed-theme {
      background: linear-gradient(135deg, #0a1a0f 0%, #0f1a14 50%, #0f1419 100%);
    }
    
    .project-header {
      background: linear-gradient(135deg, #252932 0%, #1a1d29 100%);
      padding: 1.5rem 2rem;
      border-radius: 16px;
      margin-bottom: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid rgba(255, 138, 76, 0.12);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
    
    .project-name {
      font-size: 1.75rem;
      font-weight: 600;
      color: #ff8a4c;
      font-family: 'Manrope', sans-serif;
      letter-spacing: -0.5px;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .change-project-btn {
      background: rgba(255, 138, 76, 0.08);
      color: #ff8a4c;
      border: 1px solid rgba(255, 138, 76, 0.2);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-size: 0.875rem;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .change-project-btn:hover {
      background: rgba(255, 138, 76, 0.15);
      border-color: #ff8a4c;
    }
    
    .calculator-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }
    
    /* Input Sections */
    .input-section {
      background: linear-gradient(135deg, #1a1d29 0%, #252932 100%);
      padding: 1.5rem;
      border-radius: 16px;
      border: 1px solid rgba(255, 138, 76, 0.12);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
    
    .section-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: #ff8a4c;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid rgba(255, 138, 76, 0.2);
      font-family: 'Manrope', sans-serif;
      letter-spacing: -0.3px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .input-group {
      margin-bottom: 1rem;
    }
    
    .input-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: #9ca3af;
      font-family: 'Inter', sans-serif;
      text-transform: none;
      letter-spacing: 0.2px;
    }
    
    .input-group input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid rgba(255, 138, 76, 0.15);
      border-radius: 8px;
      font-size: 0.9375rem;
      background: rgba(15, 20, 25, 0.6);
      color: #e8eaed;
      font-family: 'Inter', sans-serif;
      font-weight: 400;
      transition: all 0.2s ease;
      height: 42px;
      line-height: 1.2;
      box-sizing: border-box;
    }
    
    .input-group input:focus {
      outline: none;
      border-color: #ff8a4c;
      box-shadow: 0 0 0 3px rgba(255, 138, 76, 0.1);
      background: rgba(15, 20, 25, 0.8);
    }
    
    .input-group small {
      display: block;
      color: #6b7280;
      font-size: 0.8125rem;
      margin-top: 0.25rem;
      font-family: 'Inter', sans-serif;
      font-weight: 400;
    }
    
    /* Toggles */
    .toggle-group {
      margin-bottom: 0.75rem;
    }
    
    .toggle-label {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      border-radius: 8px;
      transition: all 0.2s ease;
      border: 1px solid transparent;
    }
    
    .toggle-label:hover {
      background: rgba(255, 138, 76, 0.05);
      border-color: rgba(255, 138, 76, 0.15);
    }
    
    .toggle-label input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: #ff8a4c;
    }
    
    .toggle-label span {
      font-family: 'Inter', sans-serif;
      font-size: 0.9375rem;
      color: #d1d5db;
      font-weight: 400;
    }
    
    /* Results Section */
    .results-section {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, #1a1d29 0%, #252932 100%);
      padding: 2rem;
      border-radius: 16px;
      border: 1px solid rgba(255, 138, 76, 0.12);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }
    
    .results-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }
    
    .results-table thead {
      background: rgba(255, 138, 76, 0.08);
      border-bottom: 2px solid rgba(255, 138, 76, 0.2);
    }
    
    .results-table th {
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      color: #ff8a4c;
      font-family: 'Manrope', sans-serif;
      letter-spacing: -0.2px;
      font-size: 0.9375rem;
    }
    
    .results-table th:nth-child(2),
    .results-table th:nth-child(3),
    .results-table th:nth-child(4) {
      text-align: right;
    }
    
    .results-table td {
      padding: 0.875rem 1rem;
      border-bottom: 1px solid rgba(255, 138, 76, 0.08);
      color: #d1d5db;
      font-family: 'Inter', sans-serif;
      font-size: 0.9375rem;
      font-weight: 400;
      height: 52px;
      line-height: 1.2;
      vertical-align: middle;
    }
    
    .results-table td:nth-child(2),
    .results-table td:nth-child(3),
    .results-table td:nth-child(4) {
      text-align: right;
    }
    
    .results-table tbody tr:hover {
      background: rgba(255, 138, 76, 0.03);
    }
    
    .rate-input {
      width: 110px;
      padding: 0.5rem 0.75rem;
      border: 1px solid rgba(255, 138, 76, 0.25);
      border-radius: 6px;
      text-align: right;
      background: rgba(15, 20, 25, 0.8);
      color: #e8eaed;
      font-family: 'Inter', sans-serif;
      font-size: 0.9375rem;
      font-weight: 500;
      height: 36px;
      line-height: 1.2;
      box-sizing: border-box;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    
    .rate-input::placeholder {
      color: #4b5563;
    }
    
    .rate-input:focus {
      outline: none;
      border-color: #ff8a4c;
      box-shadow: 0 0 0 2px rgba(255, 138, 76, 0.15);
      background: rgba(15, 20, 25, 0.95);
    }
    
    .results-table tfoot {
      background: rgba(0, 0, 0, 0.3);
      font-weight: 700;
    }
    
    .results-table tfoot td {
      padding: 1rem;
      border-top: 2px solid rgba(255, 138, 76, 0.2);
      font-family: 'Manrope', sans-serif;
      font-size: 1rem;
      letter-spacing: -0.2px;
      font-weight: 600;
    }
    
    .gst-row {
      background: rgba(255, 138, 76, 0.08) !important;
      color: #ff8a4c !important;
    }
    
    .grand-total-row {
      background: rgba(255, 138, 76, 0.15) !important;
      color: #ff8a4c !important;
      font-size: 1.1rem !important;
    }
    
    .per-sqft-row {
      background: rgba(255, 173, 122, 0.08) !important;
      color: #ffad7a !important;
    }
    
    .per-sqft-row-with-gst {
      background: rgba(255, 173, 122, 0.12) !important;
      color: #ffad7a !important;
      font-weight: 600 !important;
    }
    
    /* GST Toggle Custom Styling */
    .gst-toggle-btn {
      position: relative;
      background: rgba(255, 20, 147, 0.15);
      border: 2px solid rgba(255, 20, 147, 0.4);
      color: #ff1493;
      padding: 0.75rem 1.25rem;
      border-radius: 10px;
      font-size: 0.9375rem;
      font-family: 'Inter', sans-serif;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.625rem;
      font-weight: 600;
      box-shadow: 0 0 20px rgba(255, 20, 147, 0.4), 0 0 40px rgba(255, 20, 147, 0.2);
      animation: pinkGlow 2s ease-in-out infinite;
      cursor: pointer;
      margin-left: 0.5rem;
    }
    
    .gst-toggle-btn:hover {
      background: rgba(255, 20, 147, 0.25);
      border-color: #ff1493;
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 0 35px rgba(255, 20, 147, 0.7), 0 0 70px rgba(255, 20, 147, 0.5);
    }
    
    .gst-toggle-btn input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: #ff1493;
      cursor: pointer;
      flex-shrink: 0;
    }
    
    /* Footer */
    footer {
      background: #252932;
      color: #9ca3af;
      text-align: center;
      padding: 1.5rem;
      font-size: 0.875rem;
      margin-top: 2rem;
      border-top: 1px solid rgba(255, 138, 76, 0.1);
      font-family: 'Inter', sans-serif;
      line-height: 1.8;
      font-weight: 400;
    }
    
    footer .ms-spec-btn {
      background: linear-gradient(135deg, #05EAF2 0%, #04c9d1 100%);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-size: 1rem;
      font-family: 'Manrope', sans-serif;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      box-shadow: 0 4px 20px rgba(5, 234, 242, 0.4);
      margin-bottom: 1.5rem;
      letter-spacing: -0.3px;
      cursor: pointer;
    }
    
    footer .ms-spec-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 30px rgba(5, 234, 242, 0.6);
      background: linear-gradient(135deg, #04c9d1 0%, #05EAF2 100%);
    }
    
    footer .ms-spec-btn svg {
      flex-shrink: 0;
    }
    
    footer .powered-by {
      color: #ff8a4c;
      font-weight: 600;
      margin-top: 0.5rem;
    }
    
    footer .contact {
      color: #ffad7a;
      font-weight: 500;
    }
    
    /* Responsive - Mobile First */
    @media (max-width: 768px) {
      /* Header Mobile Optimization */
      header {
        padding: 1.25rem 1rem;
        position: relative;
      }
      
      h1 {
        font-size: 2rem;
        line-height: 1.1;
        letter-spacing: -0.5px;
        font-weight: 700;
      }
      
      .subtitle {
        font-size: 0.8125rem;
        letter-spacing: 0.2px;
        margin-top: 0.35rem;
      }
      
      .theme-toggle {
        position: absolute;
        top: 1rem;
        right: 1rem;
        padding: 0.5rem 0.75rem;
        font-size: 0.75rem;
        min-height: 44px;
        display: flex;
        align-items: center;
      }
      
      .theme-toggle svg {
        width: 16px;
        height: 16px;
      }
      
      /* Selection Screen Mobile */
      .selection-screen {
        padding: 1rem;
      }
      
      .selection-box {
        padding: 1.5rem;
        border-radius: 16px;
      }
      
      .selection-box h2 {
        font-size: 1.75rem;
        line-height: 1.2;
      }
      
      .selection-subtitle {
        font-size: 0.875rem;
        margin-bottom: 1.5rem;
      }
      
      .project-types {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .project-type-btn {
        padding: 1.5rem 1rem;
        font-size: 1.125rem;
        min-height: 120px;
      }
      
      .project-icon {
        margin-bottom: 0.5rem;
      }
      
      .project-icon svg {
        width: 36px;
        height: 36px;
      }
      
      .project-meta {
        font-size: 0.75rem;
        margin-top: 0.35rem;
      }
      
      /* Calculator Screen Mobile */
      .calculator-screen {
        padding: 1rem;
      }
      
      .project-header {
        flex-direction: column;
        gap: 0.75rem;
        align-items: stretch;
        padding: 1rem;
      }
      
      .project-name {
        font-size: 1.375rem;
        gap: 0.5rem;
        justify-content: flex-start;
      }
      
      .project-name svg {
        width: 24px;
        height: 24px;
      }
      
      .change-project-btn {
        width: 100%;
        padding: 0.75rem 1rem;
        font-size: 0.875rem;
        min-height: 44px;
        justify-content: center;
        display: flex;
        align-items: center;
      }
      
      /* Single Column Layout */
      .calculator-content {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      /* Input Sections Mobile */
      .input-section {
        padding: 1rem;
        border-radius: 12px;
      }
      
      .section-title {
        font-size: 1.0625rem;
        margin-bottom: 0.75rem;
        padding-bottom: 0.4rem;
      }
      
      .section-title svg {
        width: 18px;
        height: 18px;
      }
      
      .input-group {
        margin-bottom: 1rem;
      }
      
      .input-group label {
        font-size: 0.875rem;
        margin-bottom: 0.4rem;
      }
      
      .input-group input,
      .input-group select {
        width: 100%;
        padding: 0.875rem;
        font-size: 1rem;
        min-height: 48px;
        height: 48px;
        border-radius: 10px;
      }
      
      .input-group select {
      }
      
      .input-group small {
        font-size: 0.8125rem;
        margin-top: 0.35rem;
      }
      
      /* Toggle Labels Mobile */
      .toggle-label {
        padding: 0.875rem;
        min-height: 48px;
        gap: 0.875rem;
      }
      
      .toggle-label input[type="checkbox"] {
        width: 24px;
        height: 24px;
        flex-shrink: 0;
      }
      
      .toggle-label span {
        font-size: 0.9375rem;
        line-height: 1.3;
      }
      
      /* Internal Walls Mobile */
      .internal-wall-entry {
        grid-template-columns: auto 1fr;
        gap: 0.5rem;
        margin-bottom: 0.75rem;
      }
      
      .internal-wall-entry label {
        font-size: 0.875rem;
        min-width: 55px;
      }
      
      .internal-wall-entry input {
        min-height: 48px;
        height: 48px;
        padding: 0.875rem;
        font-size: 1rem;
      }
      
      /* Results Section Mobile - Card Style */
      .results-section {
        padding: 1rem;
        border-radius: 12px;
      }
      
      /* Hide traditional table on mobile, use card layout */
      .results-table {
        display: none;
      }
      
      /* Action Buttons Mobile */
      .action-buttons {
        flex-direction: column;
        width: 100%;
        margin-top: 0.5rem;
      }
      
      .action-btn {
        width: 100%;
        padding: 0.75rem 1rem;
        min-height: 48px;
        justify-content: center;
        font-size: 0.9375rem;
      }
      
      .section-title {
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: 0.75rem;
      }
      
      /* Mobile Card Layout */
      .results-mobile-cards {
        display: block;
      }
      
      .result-card {
        background: rgba(15, 20, 25, 0.4);
        border: 1px solid rgba(255, 138, 76, 0.15);
        border-radius: 10px;
        padding: 1rem;
        margin-bottom: 0.75rem;
      }
      
      .result-card-header {
        font-family: 'Manrope', sans-serif;
        font-size: 1rem;
        font-weight: 600;
        color: #ff8a4c;
        margin-bottom: 0.75rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid rgba(255, 138, 76, 0.15);
        letter-spacing: -0.2px;
      }
      
      .result-card-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
        font-family: 'Inter', sans-serif;
        font-size: 0.9375rem;
      }
      
      .result-card-row:last-child {
        margin-bottom: 0;
      }
      
      .result-card-label {
        color: #9ca3af;
        font-size: 0.875rem;
        text-transform: none;
        letter-spacing: 0.2px;
      }
      
      .result-card-value {
        color: #d1d5db;
        font-weight: 500;
        text-align: right;
      }
      
      .result-card .rate-input {
        width: 100px;
        padding: 0.5rem;
        font-size: 0.9375rem;
        min-height: 44px;
        height: 44px;
        border-radius: 8px;
      }
      
      /* Mobile Totals */
      .results-mobile-totals {
        display: block;
        margin-top: 1rem;
      }
      
      .total-card {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 0.875rem 1rem;
        margin-bottom: 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-family: 'Manrope', sans-serif;
        letter-spacing: -0.3px;
        font-weight: 600;
      }
      
      .total-card.subtotal {
        background: rgba(15, 20, 25, 0.6);
        font-size: 1rem;
      }
      
      .total-card.gst {
        background: rgba(255, 138, 76, 0.08);
        color: #ff8a4c;
        font-size: 1rem;
      }
      
      .total-card.grand {
        background: rgba(255, 138, 76, 0.15);
        color: #ff8a4c;
        font-size: 1.125rem;
        font-weight: 700;
        padding: 1rem;
      }
      
      .total-card.per-sqft {
        background: rgba(255, 173, 122, 0.08);
        color: #ffad7a;
        font-size: 0.9375rem;
      }
      
      .total-card.per-sqft-gst {
        background: rgba(255, 173, 122, 0.12);
        color: #ffad7a;
        font-size: 1rem;
        font-weight: 600;
      }
      
      .total-card-label {
        flex: 1;
      }
      
      .total-card-value {
        text-align: right;
        font-weight: 700;
      }
      
      /* Footer Mobile */
      footer {
        padding: 1.25rem 1rem;
        font-size: 0.8125rem;
        margin-top: 1rem;
        line-height: 1.6;
      }
      
      footer .powered-by {
        margin-top: 0.35rem;
      }
      
      /* Light Mode Mobile Adjustments */
      body.light-mode .result-card {
        background: rgba(255, 255, 255, 0.6);
        border: 1px solid rgba(255, 138, 76, 0.2);
      }
      
      body.light-mode .result-card-value {
        color: #374151;
      }
      
      body.light-mode .total-card.subtotal {
        background: rgba(255, 255, 255, 0.8);
      }
      
      body.light-mode .result-card .rate-input {
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid rgba(255, 138, 76, 0.3);
        color: #1a202c;
      }
    }
    
    /* Print Styles - Temporarily Disabled for Testing */
    
    /* Desktop: Show table, hide mobile cards */
    @media (min-width: 769px) {
      .results-mobile-cards {
        display: none;
      }
      
      .results-mobile-totals {
        display: none;
      }
      
      .results-table {
        display: table;
      }
    }
    
    .hidden {
      display: none;
    }
    
    /* Action buttons for Print and PDF */
    .action-buttons {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    
    .action-btn {
      background: rgba(255, 138, 76, 0.1);
      border: 1px solid rgba(255, 138, 76, 0.3);
      color: #ff8a4c;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-size: 0.875rem;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
    }
    
    .action-btn:hover {
      background: rgba(255, 138, 76, 0.2);
      border-color: #ff8a4c;
      transform: translateY(-2px);
    }
    
    .action-btn svg {
      flex-shrink: 0;
    }
    
    body.light-mode .action-btn {
      background: rgba(255, 138, 76, 0.08);
      border: 1px solid rgba(255, 138, 76, 0.25);
    }
    
    body.light-mode .action-btn:hover {
      background: rgba(255, 138, 76, 0.15);
      border-color: #ff8a4c;
    }
    
    /* GST Toggle Custom Styling - Pink Glowing Button */
    .gst-toggle-btn {
      background: rgba(255, 20, 147, 0.15);
      border: 2px solid rgba(255, 20, 147, 0.4);
      color: #ff1493;
      padding: 0.75rem 1.25rem;
      border-radius: 10px;
      font-size: 0.9375rem;
      font-family: 'Inter', sans-serif;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.625rem;
      font-weight: 600;
      box-shadow: 0 0 20px rgba(255, 20, 147, 0.4), 0 0 40px rgba(255, 20, 147, 0.2);
      animation: pinkGlow 2s ease-in-out infinite;
      cursor: pointer;
    }
    
    .gst-toggle-btn:hover {
      background: rgba(255, 20, 147, 0.25);
      border-color: #ff1493;
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 0 35px rgba(255, 20, 147, 0.7), 0 0 70px rgba(255, 20, 147, 0.5);
    }
    
    .gst-toggle-btn input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: #ff1493;
      cursor: pointer;
      flex-shrink: 0;
    }
    
    /* Internal walls dynamic input */
    .internal-wall-entry {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 0.75rem;
    }
    
    .internal-wall-entry label {
      font-size: 0.875rem;
      color: #ff8a4c;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      min-width: 60px;
    }
    
    .internal-wall-entry input {
      background: rgba(15, 20, 25, 0.6);
      border: 1px solid rgba(255, 138, 76, 0.15);
      color: #e8eaed;
      padding: 0.75rem;
      border-radius: 8px;
      font-family: 'Inter', sans-serif;
      font-weight: 400;
      height: 42px;
      line-height: 1.2;
      box-sizing: border-box;
    }
    
    .internal-wall-entry input:focus {
      border-color: #ff8a4c;
      box-shadow: 0 0 0 3px rgba(255, 138, 76, 0.1);
      background: rgba(15, 20, 25, 0.8);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div class="app-container"><!-- Header -->
   <header><button type="button" class="theme-toggle" onclick="toggleTheme()" id="theme-toggle-btn">
     <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
     </svg>
     <svg id="moon-icon" style="display: none;" xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
     </svg><span id="theme-text">Light</span> </button>
    <div class="header-text">
     <h1 id="company-name">Contrive Interior &amp; Construction</h1>
     <div class="subtitle">
      Internal Quotation Calculation Tool
     </div>
    </div>
   </header><!-- Project Type Selection Screen -->
   <div id="selection-screen" class="selection-screen">
    <div class="selection-box">
     <h2>Select Project Type</h2>
     <p class="selection-subtitle">Choose one to begin calculation</p>
     <div class="project-types"><button type="button" class="project-type-btn aerocon" onclick="selectProject('aerocon', 10)">
       <div class="project-icon">
        <svg width="48" height="48" viewbox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><!-- Base structure --> <rect x="4" y="14" width="40" height="28" rx="2" stroke="#ff8a4c" stroke-width="2.5" fill="rgba(255, 138, 76, 0.05)" /> <!-- Roof overhang --> <path d="M2 14h44" stroke="#ff8a4c" stroke-width="2.5" stroke-linecap="round" /> <!-- Door --> <rect x="10" y="26" width="10" height="16" rx="1" stroke="#ff8a4c" stroke-width="2" fill="rgba(255, 138, 76, 0.1)" /> <circle cx="17" cy="34" r="1" fill="#ff8a4c" /> <!-- Windows --> <rect x="24" y="20" width="8" height="8" rx="1" stroke="#ff8a4c" stroke-width="2" fill="rgba(255, 138, 76, 0.08)" /> <line x1="28" y1="20" x2="28" y2="28" stroke="#ff8a4c" stroke-width="1.5" /> <line x1="24" y1="24" x2="32" y2="24" stroke="#ff8a4c" stroke-width="1.5" /> <rect x="34" y="20" width="8" height="8" rx="1" stroke="#ff8a4c" stroke-width="2" fill="rgba(255, 138, 76, 0.08)" /> <line x1="38" y1="20" x2="38" y2="28" stroke="#ff8a4c" stroke-width="1.5" /> <line x1="34" y1="24" x2="42" y2="24" stroke="#ff8a4c" stroke-width="1.5" />
        </svg>
       </div> Aerocon Cabin 
       <div class="project-meta">
               DEFAULT: 10 FT HEIGHT
       </div></button> <button type="button" class="project-type-btn puff" onclick="selectProject('puff', 10)">
       <div class="project-icon">
        <svg width="48" height="48" viewbox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><!-- Triangular roof house --> <path d="M24 6l-20 16v18a2 2 0 002 2h36a2 2 0 002-2V22L24 6z" stroke="#4c9fff" stroke-width="2.5" fill="rgba(76, 159, 255, 0.05)" /> <!-- Roof ridge --> <path d="M24 6v36" stroke="#4c9fff" stroke-width="2" stroke-linecap="round" /> <!-- Door --> <rect x="18" y="28" width="12" height="14" rx="1" stroke="#4c9fff" stroke-width="2" fill="rgba(76, 159, 255, 0.1)" /> <circle cx="27" cy="35" r="1" fill="#4c9fff" /> <!-- Window grid --> <rect x="8" y="20" width="6" height="6" rx="0.5" stroke="#4c9fff" stroke-width="1.5" fill="rgba(76, 159, 255, 0.08)" /> <line x1="11" y1="20" x2="11" y2="26" stroke="#4c9fff" stroke-width="1" /> <line x1="8" y1="23" x2="14" y2="23" stroke="#4c9fff" stroke-width="1" /> <rect x="34" y="20" width="6" height="6" rx="0.5" stroke="#4c9fff" stroke-width="1.5" fill="rgba(76, 159, 255, 0.08)" /> <line x1="37" y1="20" x2="37" y2="26" stroke="#4c9fff" stroke-width="1" /> <line x1="34" y1="23" x2="40" y2="23" stroke="#4c9fff" stroke-width="1" />
        </svg>
       </div> Puff Cabin 
       <div class="project-meta">
        üîµ DEFAULT: 10 FT HEIGHT
       </div></button> <button type="button" class="project-type-btn container" onclick="selectProject('container', 10)">
       <div class="project-icon">
        <svg width="48" height="48" viewbox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><!-- Container body --> <rect x="4" y="16" width="40" height="20" rx="1" stroke="#9f4cff" stroke-width="2.5" fill="rgba(159, 76, 255, 0.05)" /> <!-- Corrugated lines --> <line x1="8" y1="16" x2="8" y2="36" stroke="#9f4cff" stroke-width="1.5" /> <line x1="12" y1="16" x2="12" y2="36" stroke="#9f4cff" stroke-width="1.5" /> <line x1="16" y1="16" x2="16" y2="36" stroke="#9f4cff" stroke-width="1.5" /> <line x1="20" y1="16" x2="20" y2="36" stroke="#9f4cff" stroke-width="1.5" /> <line x1="24" y1="16" x2="24" y2="36" stroke="#9f4cff" stroke-width="2" /> <line x1="28" y1="16" x2="28" y2="36" stroke="#9f4cff" stroke-width="1.5" /> <line x1="32" y1="16" x2="32" y2="36" stroke="#9f4cff" stroke-width="1.5" /> <line x1="36" y1="16" x2="36" y2="36" stroke="#9f4cff" stroke-width="1.5" /> <line x1="40" y1="16" x2="40" y2="36" stroke="#9f4cff" stroke-width="1.5" /> <!-- Corner reinforcements --> <rect x="2" y="14" width="4" height="4" stroke="#9f4cff" stroke-width="2" fill="rgba(159, 76, 255, 0.15)" /> <rect x="42" y="14" width="4" height="4" stroke="#9f4cff" stroke-width="2" fill="rgba(159, 76, 255, 0.15)" /> <!-- Wheels --> <circle cx="12" cy="38" r="3" stroke="#9f4cff" stroke-width="2" fill="rgba(159, 76, 255, 0.1)" /> <circle cx="36" cy="38" r="3" stroke="#9f4cff" stroke-width="2" fill="rgba(159, 76, 255, 0.1)" />
        </svg>
       </div> Container 
       <div class="project-meta">
            DEFAULT: 10 FT HEIGHT
       </div></button> <button type="button" class="project-type-btn shed" onclick="selectProject('shed', 12)">
       <div class="project-icon">
        <svg width="48" height="48" viewbox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><!-- Gable roof --> <path d="M4 20l20-12 20 12v20H4V20z" stroke="#4cff8a" stroke-width="2.5" fill="rgba(76, 255, 138, 0.05)" /> <!-- Roof ridge line --> <path d="M24 8v32" stroke="#4cff8a" stroke-width="2.5" stroke-linecap="round" /> <!-- Roof panels --> <path d="M4 20l20 10 20-10" stroke="#4cff8a" stroke-width="2" /> <!-- Horizontal beams --> <line x1="4" y1="26" x2="44" y2="26" stroke="#4cff8a" stroke-width="2" /> <line x1="4" y1="32" x2="44" y2="32" stroke="#4cff8a" stroke-width="2" /> <!-- Support columns --> <line x1="10" y1="26" x2="10" y2="40" stroke="#4cff8a" stroke-width="2.5" /> <line x1="38" y1="26" x2="38" y2="40" stroke="#4cff8a" stroke-width="2.5" /> <!-- Base foundation --> <rect x="4" y="38" width="40" height="2" fill="rgba(76, 255, 138, 0.2)" stroke="#4cff8a" stroke-width="1" />
        </svg>
       </div> Shed 
       <div class="project-meta">
        üü¢ DEFAULT: 12 FT HEIGHT
       </div></button>
     </div>
    </div>
   </div><!-- Calculator Screen -->
   <div id="calculator-screen" class="calculator-screen">
    <div class="project-header">
     <div class="project-name">
      <svg width="32" height="32" viewbox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" id="project-icon-header"><!-- Aerocon Cabin Icon (Default) --> <rect x="3" y="9" width="26" height="18" rx="1.5" stroke="currentColor" stroke-width="2" fill="none" /> <path d="M2 9h28" stroke="currentColor" stroke-width="2" stroke-linecap="round" /> <rect x="7" y="17" width="6" height="10" rx="0.5" stroke="currentColor" stroke-width="1.5" fill="none" /> <circle cx="11" cy="22" r="0.8" fill="currentColor" /> <rect x="16" y="13" width="5" height="5" rx="0.5" stroke="currentColor" stroke-width="1.5" fill="none" /> <line x1="18.5" y1="13" x2="18.5" y2="18" stroke="currentColor" stroke-width="1" /> <line x1="16" y1="15.5" x2="21" y2="15.5" stroke="currentColor" stroke-width="1" /> <rect x="22" y="13" width="5" height="5" rx="0.5" stroke="currentColor" stroke-width="1.5" fill="none" /> <line x1="24.5" y1="13" x2="24.5" y2="18" stroke="currentColor" stroke-width="1" /> <line x1="22" y1="15.5" x2="27" y2="15.5" stroke="currentColor" stroke-width="1" />
      </svg><span id="current-project-name">Aerocon Cabin</span>
     </div><button type="button" class="change-project-btn" onclick="changeProject()">‚Üê CHANGE TYPE</button>
    </div>
    <div class="calculator-content"><!-- Basic Dimensions -->
     <div class="input-section">
      <div class="section-title">
       <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="16" height="16" stroke="#ff8a4c" stroke-width="2" /> <line x1="2" y1="10" x2="18" y2="10" stroke="#ff8a4c" stroke-width="2" /> <line x1="10" y1="2" x2="10" y2="18" stroke="#ff8a4c" stroke-width="2" />
       </svg> Basic Dimensions
      </div>
      <div class="input-group"><label for="unit-select">Measurement Unit</label> <select id="unit-select" onchange="handleUnitChange()" style="width: 100%; padding: 0.75rem; border: 1px solid rgba(255, 138, 76, 0.15); border-radius: 8px; font-size: 0.9375rem; background: rgba(15, 20, 25, 0.6); color: #e8eaed; font-family: 'Inter', sans-serif; font-weight: 400; height: 42px;"> <option value="feet">Feet (ft)</option> <option value="mm">Millimeters (mm)</option> <option value="meter">Meters (m)</option> </select> <small>Select your preferred measurement unit for all measurements</small>
      </div>
      <div class="input-group"><label for="length">Length (<span id="length-unit">ft</span>)</label> <input type="number" id="length" step="0.1" value="" placeholder="Enter length" oninput="calculate()">
      </div>
      <div class="input-group"><label for="width">Width (<span id="width-unit">ft</span>)</label> <input type="number" id="width" step="0.1" value="" placeholder="Enter width" oninput="calculate()">
      </div>
      <div class="input-group"><label for="height">Height (<span id="height-unit">ft</span>) - Editable</label> <input type="number" id="height" step="0.1" value="10" oninput="calculate()">
      </div>
     </div><!-- Doors & Windows -->
     <div class="input-section">
      <div class="section-title">
       <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="2" width="6" height="16" stroke="#ff8a4c" stroke-width="2" /> <rect x="11" y="5" width="6" height="10" stroke="#ff8a4c" stroke-width="2" />
       </svg> Doors &amp; Windows
      </div>
      <div class="input-group"><label for="num-doors">Number of Doors</label> <input type="number" id="num-doors" min="0" value="0" placeholder="Enter number" oninput="calculate()">
      </div>
      <div class="input-group"><label for="door-length">Door Length (<span id="door-length-unit">ft</span>)</label> <input type="number" id="door-length" step="0.1" value="7" oninput="calculate()">
      </div>
      <div class="input-group"><label for="door-width">Door Width (<span id="door-width-unit">ft</span>)</label> <input type="number" id="door-width" step="0.1" value="3" oninput="calculate()">
      </div>
      <div class="input-group"><label for="num-windows">Number of Windows</label> <input type="number" id="num-windows" min="0" value="0" placeholder="Enter number" oninput="calculate()">
      </div>
      <div class="input-group"><label for="window-length">Window Length (<span id="window-length-unit">ft</span>)</label> <input type="number" id="window-length" step="0.1" value="4" oninput="calculate()">
      </div>
      <div class="input-group"><label for="window-width">Window Width (<span id="window-width-unit">ft</span>)</label> <input type="number" id="window-width" step="0.1" value="3" oninput="calculate()">
      </div>
     </div><!-- Internal Walls -->
     <div class="input-section">
      <div class="section-title">
       <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><line x1="10" y1="2" x2="10" y2="18" stroke="#ff8a4c" stroke-width="3" /> <line x1="6" y1="6" x2="14" y2="6" stroke="#ff8a4c" stroke-width="2" /> <line x1="6" y1="14" x2="14" y2="14" stroke="#ff8a4c" stroke-width="2" />
       </svg> Internal Partition Walls
      </div>
      <div class="input-group"><label for="num-internal-walls">Number of Internal Walls</label> <input type="number" id="num-internal-walls" min="0" max="20" value="0" oninput="updateInternalWalls()">
      </div>
      <div id="internal-walls-container"></div>
     </div><!-- Optional Components -->
     <div class="input-section">
      <div class="section-title">
       <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="8" stroke="#ff8a4c" stroke-width="2" /> <path d="M7 10l2 2 4-4" stroke="#ff8a4c" stroke-width="2" />
       </svg> Optional Components
      </div>
      <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="opt-tiles" onchange="calculate()"> <span>Tiles + Skirting</span> </label>
      </div>
      <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="opt-false-ceiling" onchange="calculate()"> <span>False Ceiling</span> </label>
      </div>
      <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="opt-false-floor" onchange="calculate()"> <span>False Floor</span> </label>
      </div>
      <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="opt-insulation" onchange="calculate()"> <span>Insulation</span> </label>
      </div>
      <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="opt-toilet" onchange="calculate()"> <span>Toilet Unit</span> </label>
      </div>
      <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="opt-kitchen" onchange="calculate()"> <span>Kitchen</span> </label>
      </div>
      <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="opt-cement-fiber" onchange="calculate()"> <span>Cement Fiber Plank</span> </label>
      </div>
     </div><!-- Results Table -->
     <div class="results-section">
      <div class="section-title" style="display: flex; justify-content: space-between; align-items: center;">
       <div style="display: flex; align-items: center; gap: 0.5rem;">
        <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="16" height="16" rx="1" stroke="#ff8a4c" stroke-width="2" /> <text x="10" y="13" text-anchor="middle" fill="#ff8a4c" font-size="10" font-weight="bold">
          ‚Çπ
         </text>
        </svg> Calculation Results
       </div>
       <div class="action-buttons"><button type="button" class="action-btn" onclick="printCalculation()">
         <svg width="18" height="18" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 9V2h12v7M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /> <rect x="6" y="14" width="12" height="8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
         </svg> Print </button> <button type="button" class="action-btn" onclick="clearAllRates()">
         <svg width="18" height="18" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
         </svg> Clear </button> <button type="button" class="action-btn" onclick="downloadPDF()">
         <svg width="18" height="18" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
         </svg> Save PDF </button>
       </div>
      </div><!-- Desktop Table -->
      <table class="results-table">
       <thead>
        <tr>
         <th>Component</th>
         <th>Quantity</th>
         <th>Rate</th>
         <th>Amount</th>
        </tr>
       </thead>
       <tbody id="results-body"><!-- Results will be populated here -->
       </tbody>
       <tfoot>
        <tr>
         <td colspan="3" style="font-weight: 600;">Subtotal (Without GST)</td>
         <td id="subtotal" style="font-weight: 600;">‚Çπ0.00</td>
        </tr>
        <tr class="gst-row">
         <td colspan="3">GST @18%</td>
         <td id="gst-amount">‚Çπ0.00</td>
        </tr>
        <tr class="grand-total-row">
         <td colspan="3">Grand Total (With GST)</td>
         <td id="grand-total">‚Çπ0.00</td>
        </tr>
        <tr class="per-sqft-row">
         <td colspan="3">Per Sq.Ft Cost (Without GST)</td>
         <td id="per-sqft-cost-without-gst">‚Çπ0.00</td>
        </tr>
        <tr class="per-sqft-row-with-gst">
         <td colspan="3">Per Sq.Ft Cost (With GST)</td>
         <td id="per-sqft-cost">‚Çπ0.00</td>
        </tr>
       </tfoot>
      </table><!-- Mobile Card Layout -->
      <div class="results-mobile-cards" id="results-mobile-cards"><!-- Mobile cards will be populated here -->
      </div><!-- Mobile Totals -->
      <div class="results-mobile-totals">
       <div class="total-card subtotal"><span class="total-card-label">Subtotal (Without GST)</span> <span class="total-card-value" id="subtotal-mobile">‚Çπ0.00</span>
       </div>
       <div class="total-card gst"><span class="total-card-label">GST @18%</span> <span class="total-card-value" id="gst-amount-mobile">‚Çπ0.00</span>
       </div>
       <div class="total-card grand"><span class="total-card-label">Grand Total (With GST)</span> <span class="total-card-value" id="grand-total-mobile">‚Çπ0.00</span>
       </div>
       <div class="total-card per-sqft"><span class="total-card-label">Per Sq.Ft (Without GST)</span> <span class="total-card-value" id="per-sqft-cost-without-gst-mobile">‚Çπ0.00</span>
       </div>
       <div class="total-card per-sqft-gst"><span class="total-card-label">Per Sq.Ft (With GST)</span> <span class="total-card-value" id="per-sqft-cost-mobile">‚Çπ0.00</span>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Material Specification Screen -->
   <div id="material-spec-screen" class="calculator-screen" style="display: none;">
    <div class="project-header">
     <div class="project-name">
      <svg width="32" height="32" viewbox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="4" width="24" height="24" rx="2" stroke="#ff8a4c" stroke-width="2" /> <line x1="9" y1="10" x2="23" y2="10" stroke="#ff8a4c" stroke-width="2" /> <line x1="9" y1="16" x2="23" y2="16" stroke="#ff8a4c" stroke-width="2" /> <line x1="9" y1="22" x2="18" y2="22" stroke="#ff8a4c" stroke-width="2" />
      </svg><span>M.S. ‚Äì Material Specification</span>
     </div><button type="button" class="change-project-btn" onclick="closeMaterialSpec()">‚Üê BACK TO CALCULATOR</button>
    </div>
    <div class="calculator-content"><!-- Pipe Selection -->
     <div class="input-section" style="grid-column: 1 / -1;">
      <div class="section-title">
       <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="6" width="16" height="3" rx="0.5" stroke="#ff8a4c" stroke-width="2" /> <rect x="2" y="11" width="16" height="3" rx="0.5" stroke="#ff8a4c" stroke-width="2" />
       </svg> Select Materials to Calculate
      </div><small style="color: #6b7280; font-size: 0.8125rem; display: block; margin-bottom: 0.75rem; font-family: 'Inter', sans-serif;"> ‚úÖ Tick the materials you want to include in calculation. Only selected items will appear in the table below. </small>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 0.5rem;">
       <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="pipe-select-0" onchange="updateMaterialSpecTable()"> <span>MS Pipe 25√ó25</span> </label>
       </div>
       <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="pipe-select-1" onchange="updateMaterialSpecTable()"> <span>MS Pipe 40√ó40 (2.0mm)</span> </label>
       </div>
       <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="pipe-select-2" onchange="updateMaterialSpecTable()"> <span>MS Pipe 40√ó80 (2.2mm)</span> </label>
       </div>
       <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="pipe-select-3" onchange="updateMaterialSpecTable()"> <span>MS Pipe 50√ó100 (2.5mm)</span> </label>
       </div>
       <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="pipe-select-4" onchange="updateMaterialSpecTable()"> <span>MS Pipe 100√ó100 (3.0mm)</span> </label>
       </div>
       <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="pipe-select-5" onchange="updateMaterialSpecTable()"> <span>MS Pipe 100√ó150 (3.0mm)</span> </label>
       </div>
       <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="pipe-select-6" onchange="updateMaterialSpecTable()"> <span>MS Pipe 150√ó150 (3.5mm)</span> </label>
       </div>
       <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="pipe-select-7" onchange="updateMaterialSpecTable()"> <span>C Channel 5" ISMC 125 (2.5mm)</span> </label>
       </div>
       <div class="toggle-group"><label class="toggle-label"> <input type="checkbox" id="pipe-select-8" onchange="updateMaterialSpecTable()"> <span>C Channel 5" ISMC 125 (5.0mm)</span> </label>
       </div>
      </div>
     </div><!-- GST Toggle -->
     <div class="input-section" style="grid-column: 1 / -1;">
      <div class="section-title">
       <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 2L2 6v4c0 5 3 8 8 10 5-2 8-5 8-10V6l-8-4z" stroke="#ff8a4c" stroke-width="2" />
       </svg> GST Configuration
      </div>
      <div class="toggle-group"><label class="gst-toggle-btn"> <input type="checkbox" id="gst-included" onchange="calculateMaterialSpec()"> <span>GST Included in Rate</span> </label>
      </div><small style="color: #6b7280; font-size: 0.8125rem; display: block; margin-top: 0.5rem; font-family: 'Inter', sans-serif;"> <strong>GST Logic:</strong> Component amounts are calculated directly (Weight √ó Rate). GST @18% is added to the grand total only when this box is checked. </small>
     </div><!-- Material Specification Table -->
     <div class="results-section" style="grid-column: 1 / -1;">
      <div class="section-title" style="display: flex; justify-content: space-between; align-items: center;">
       <div style="display: flex; align-items: center; gap: 0.5rem;">
        <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="16" height="16" rx="1" stroke="#ff8a4c" stroke-width="2" /> <text x="10" y="13" text-anchor="middle" fill="#ff8a4c" font-size="10" font-weight="bold">
          MS
         </text>
        </svg> Material Calculation
       </div>
       <div class="action-buttons"><button type="button" class="action-btn" onclick="printMaterialSpec()">
         <svg width="18" height="18" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 9V2h12v7M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /> <rect x="6" y="14" width="12" height="8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
         </svg> Print Material Spec </button> <button type="button" class="action-btn" onclick="clearMaterialSpec()">
         <svg width="18" height="18" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
         </svg> Clear </button>
       </div>
      </div><!-- Desktop Table -->
      <table class="results-table material-spec-table">
       <thead>
        <tr>
         <th>Material Component</th>
         <th>Size</th>
         <th>Thickness (mm)</th>
         <th>Qty (Pieces - 20ft each)</th>
         <th>Weight per Piece (kg)</th>
         <th>Total Weight (kg)</th>
         <th>Rate (‚Çπ/kg)</th>
         <th>Amount (‚Çπ)</th>
        </tr>
       </thead>
       <tbody id="material-spec-body"><!-- Material rows will be populated here -->
       </tbody>
       <tfoot>
        <tr>
         <td colspan="5" style="font-weight: 600;">Total Material Weight</td>
         <td id="total-weight" style="font-weight: 600;">0.00 kg</td>
         <td colspan="2"></td>
        </tr>
        <tr>
         <td colspan="7" style="font-weight: 600;">Subtotal (Material Cost)</td>
         <td id="material-subtotal" style="font-weight: 600;">‚Çπ0.00</td>
        </tr>
        <tr class="gst-row">
         <td colspan="7">GST @18%</td>
         <td id="material-gst-amount">‚Çπ0.00</td>
        </tr>
        <tr class="grand-total-row">
         <td colspan="7">Grand Total (With GST)</td>
         <td id="material-grand-total">‚Çπ0.00</td>
        </tr>
       </tfoot>
      </table><!-- Mobile Card Layout -->
      <div class="results-mobile-cards" id="material-spec-mobile-cards"><!-- Mobile cards will be populated here -->
      </div><!-- Mobile Totals -->
      <div class="results-mobile-totals">
       <div class="total-card"><span class="total-card-label">Total Weight</span> <span class="total-card-value" id="total-weight-mobile">0.00 kg</span>
       </div>
       <div class="total-card subtotal"><span class="total-card-label">Subtotal (Without GST)</span> <span class="total-card-value" id="material-subtotal-mobile">  0.00</span>
       </div>
       <div class="total-card gst"><span class="total-card-label">GST @18%</span> <span class="total-card-value" id="material-gst-amount-mobile">‚Çπ0.00</span>
       </div>
       <div class="total-card grand"><span class="total-card-label">Grand Total (With GST)</span> <span class="total-card-value" id="material-grand-total-mobile">‚Çπ0.00</span>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Footer -->
   <footer><button type="button" class="ms-spec-btn" onclick="openMaterialSpec()">
     <svg width="20" height="20" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2" /> <line x1="8" y1="8" x2="16" y2="8" stroke="currentColor" stroke-width="2" /> <line x1="8" y1="12" x2="16" y2="12" stroke="currentColor" stroke-width="2" /> <line x1="8" y1="16" x2="13" y2="16" stroke="currentColor" stroke-width="2" />
     </svg> M.S. ‚Äì Material Specification </button>
    <p class="powered-by">Powered by Afjal Ali</p>
    <p class="contact">Contact: +91-9452137890</p>
   </footer>
  </div>
  <script>
    // Configuration
    const defaultConfig = {
      company_name: 'Contrive Interior & Construction'
    };
    
    let config = { ...defaultConfig };
    let currentProject = null;
    let currentUnit = 'feet'; // Track current measurement unit
    
    // Element SDK initialization
    async function initElementSdk() {
      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (newConfig) => {
            config = { ...defaultConfig, ...newConfig };
            updateUIFromConfig();
          },
          mapToCapabilities: (cfg) => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ['company_name', cfg.company_name || defaultConfig.company_name]
          ])
        });
        config = { ...defaultConfig, ...window.elementSdk.config };
        updateUIFromConfig();
      }
    }
    
    function updateUIFromConfig() {
      document.getElementById('company-name').textContent = config.company_name || defaultConfig.company_name;
    }
    
    // Unit conversion functions
    function convertToFeet(value, fromUnit) {
      if (fromUnit === 'feet') return value;
      if (fromUnit === 'mm') return value / 304.8; // 1 foot = 304.8 mm
      if (fromUnit === 'meter') return value * 3.28084; // 1 meter = 3.28084 feet
      return value;
    }
    
    function convertFromFeet(value, toUnit) {
      if (toUnit === 'feet') return value;
      if (toUnit === 'mm') return value * 304.8;
      if (toUnit === 'meter') return value / 3.28084;
      return value;
    }
    
    function handleUnitChange() {
      const newUnit = document.getElementById('unit-select').value;
      
      // Get current values in feet
      const lengthInFeet = convertToFeet(parseFloat(document.getElementById('length').value) || 0, currentUnit);
      const widthInFeet = convertToFeet(parseFloat(document.getElementById('width').value) || 0, currentUnit);
      const heightInFeet = convertToFeet(parseFloat(document.getElementById('height').value) || 0, currentUnit);
      const doorLengthInFeet = convertToFeet(parseFloat(document.getElementById('door-length').value) || 0, currentUnit);
      const doorWidthInFeet = convertToFeet(parseFloat(document.getElementById('door-width').value) || 0, currentUnit);
      const windowLengthInFeet = convertToFeet(parseFloat(document.getElementById('window-length').value) || 0, currentUnit);
      const windowWidthInFeet = convertToFeet(parseFloat(document.getElementById('window-width').value) || 0, currentUnit);
      
      // Convert to new unit
      const decimalPlaces = newUnit === 'mm' ? 0 : 2;
      document.getElementById('length').value = convertFromFeet(lengthInFeet, newUnit).toFixed(decimalPlaces);
      document.getElementById('width').value = convertFromFeet(widthInFeet, newUnit).toFixed(decimalPlaces);
      document.getElementById('height').value = convertFromFeet(heightInFeet, newUnit).toFixed(decimalPlaces);
      document.getElementById('door-length').value = convertFromFeet(doorLengthInFeet, newUnit).toFixed(decimalPlaces);
      document.getElementById('door-width').value = convertFromFeet(doorWidthInFeet, newUnit).toFixed(decimalPlaces);
      document.getElementById('window-length').value = convertFromFeet(windowLengthInFeet, newUnit).toFixed(decimalPlaces);
      document.getElementById('window-width').value = convertFromFeet(windowWidthInFeet, newUnit).toFixed(decimalPlaces);
      
      // Update unit labels
      const unitLabel = newUnit === 'feet' ? 'ft' : (newUnit === 'mm' ? 'mm' : 'm');
      document.getElementById('length-unit').textContent = unitLabel;
      document.getElementById('width-unit').textContent = unitLabel;
      document.getElementById('height-unit').textContent = unitLabel;
      document.getElementById('door-length-unit').textContent = unitLabel;
      document.getElementById('door-width-unit').textContent = unitLabel;
      document.getElementById('window-length-unit').textContent = unitLabel;
      document.getElementById('window-width-unit').textContent = unitLabel;
      
      // Update step size based on unit
      const stepSize = newUnit === 'mm' ? '1' : '0.01';
      document.getElementById('length').step = stepSize;
      document.getElementById('width').step = stepSize;
      document.getElementById('height').step = stepSize;
      document.getElementById('door-length').step = stepSize;
      document.getElementById('door-width').step = stepSize;
      document.getElementById('window-length').step = stepSize;
      document.getElementById('window-width').step = stepSize;
      
      // Update internal wall inputs
      updateInternalWallUnits(newUnit, stepSize);
      
      // Update current unit
      currentUnit = newUnit;
      
      // Recalculate
      calculate();
    }
    
    // Project selection
    function selectProject(type, defaultHeight) {
      const projectNames = {
        'aerocon': 'Aerocon Cabin',
        'puff': 'Puff Cabin',
        'container': 'Container',
        'shed': 'Shed'
      };
      
      // Project-specific color themes
      const projectThemes = {
        'aerocon': {
          primary: '#ff8a4c',      // Orange (default)
          secondary: '#ffad7a',
          gradient: 'linear-gradient(135deg, #ff8a4c 0%, #ffad7a 100%)'
        },
        'puff': {
          primary: '#4c9fff',      // Blue
          secondary: '#7ab8ff',
          gradient: 'linear-gradient(135deg, #4c9fff 0%, #7ab8ff 100%)'
        },
        'container': {
          primary: '#9f4cff',      // Purple
          secondary: '#ba7aff',
          gradient: 'linear-gradient(135deg, #9f4cff 0%, #ba7aff 100%)'
        },
        'shed': {
          primary: '#4cff8a',      // Green
          secondary: '#7affad',
          gradient: 'linear-gradient(135deg, #4cff8a 0%, #7affad 100%)'
        }
      };
      
      // Project-specific icons
      const projectIcons = {
        'aerocon': `
          <rect x="3" y="9" width="26" height="18" rx="1.5" stroke="currentColor" stroke-width="2" fill="none"/>
          <path d="M2 9h28" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <rect x="7" y="17" width="6" height="10" rx="0.5" stroke="currentColor" stroke-width="1.5" fill="none"/>
          <circle cx="11" cy="22" r="0.8" fill="currentColor"/>
          <rect x="16" y="13" width="5" height="5" rx="0.5" stroke="currentColor" stroke-width="1.5" fill="none"/>
          <line x1="18.5" y1="13" x2="18.5" y2="18" stroke="currentColor" stroke-width="1"/>
          <line x1="16" y1="15.5" x2="21" y2="15.5" stroke="currentColor" stroke-width="1"/>
          <rect x="22" y="13" width="5" height="5" rx="0.5" stroke="currentColor" stroke-width="1.5" fill="none"/>
          <line x1="24.5" y1="13" x2="24.5" y2="18" stroke="currentColor" stroke-width="1"/>
          <line x1="22" y1="15.5" x2="27" y2="15.5" stroke="currentColor" stroke-width="1"/>
        `,
        'puff': `
          <path d="M16 4l-12 10v12a1.5 1.5 0 001.5 1.5h21a1.5 1.5 0 001.5-1.5V14L16 4z" stroke="currentColor" stroke-width="2" fill="none"/>
          <path d="M16 4v23" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          <rect x="12" y="18" width="8" height="9" rx="0.5" stroke="currentColor" stroke-width="1.5" fill="none"/>
          <circle cx="18" cy="23" r="0.8" fill="currentColor"/>
          <rect x="6" y="13" width="4" height="4" rx="0.3" stroke="currentColor" stroke-width="1.2" fill="none"/>
          <line x1="8" y1="13" x2="8" y2="17" stroke="currentColor" stroke-width="0.8"/>
          <line x1="6" y1="15" x2="10" y2="15" stroke="currentColor" stroke-width="0.8"/>
          <rect x="22" y="13" width="4" height="4" rx="0.3" stroke="currentColor" stroke-width="1.2" fill="none"/>
          <line x1="24" y1="13" x2="24" y2="17" stroke="currentColor" stroke-width="0.8"/>
          <line x1="22" y1="15" x2="26" y2="15" stroke="currentColor" stroke-width="0.8"/>
        `,
        'container': `
          <rect x="3" y="10" width="26" height="13" rx="0.8" stroke="currentColor" stroke-width="2" fill="none"/>
          <line x1="6" y1="10" x2="6" y2="23" stroke="currentColor" stroke-width="1.2"/>
          <line x1="9" y1="10" x2="9" y2="23" stroke="currentColor" stroke-width="1.2"/>
          <line x1="12" y1="10" x2="12" y2="23" stroke="currentColor" stroke-width="1.2"/>
          <line x1="15" y1="10" x2="15" y2="23" stroke="currentColor" stroke-width="1.2"/>
          <line x1="16" y1="10" x2="16" y2="23" stroke="currentColor" stroke-width="1.5"/>
          <line x1="17" y1="10" x2="17" y2="23" stroke="currentColor" stroke-width="1.2"/>
          <line x1="20" y1="10" x2="20" y2="23" stroke="currentColor" stroke-width="1.2"/>
          <line x1="23" y1="10" x2="23" y2="23" stroke="currentColor" stroke-width="1.2"/>
          <line x1="26" y1="10" x2="26" y2="23" stroke="currentColor" stroke-width="1.2"/>
          <rect x="1.5" y="8.5" width="2.5" height="2.5" stroke="currentColor" stroke-width="1.5" fill="none"/>
          <rect x="28" y="8.5" width="2.5" height="2.5" stroke="currentColor" stroke-width="1.5" fill="none"/>
          <circle cx="9" cy="25" r="2" stroke="currentColor" stroke-width="1.5" fill="none"/>
          <circle cx="23" cy="25" r="2" stroke="currentColor" stroke-width="1.5" fill="none"/>
        `,
        'shed': `
          <path d="M3 13l13-8 13 8v12H3V13z" stroke="currentColor" stroke-width="2" fill="none"/>
          <path d="M16 5v20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M3 13l13 6.5 13-6.5" stroke="currentColor" stroke-width="1.5"/>
          <line x1="3" y1="17" x2="29" y2="17" stroke="currentColor" stroke-width="1.5"/>
          <line x1="3" y1="21" x2="29" y2="21" stroke="currentColor" stroke-width="1.5"/>
          <line x1="8" y1="17" x2="8" y2="25" stroke="currentColor" stroke-width="2"/>
          <line x1="24" y1="17" x2="24" y2="25" stroke="currentColor" stroke-width="2"/>
          <rect x="3" y="24" width="26" height="1.5" fill="currentColor" opacity="0.3"/>
        `
      };
      
      currentProject = {
        type: type,
        name: projectNames[type],
        defaultHeight: defaultHeight,
        theme: projectThemes[type]
      };
      
      // Apply theme colors to CSS variables
      applyProjectTheme(projectThemes[type]);
      
      // Update header icon
      const headerIcon = document.getElementById('project-icon-header');
      if (headerIcon) {
        headerIcon.innerHTML = projectIcons[type];
      }
      
      document.getElementById('height').value = defaultHeight;
      document.getElementById('current-project-name').textContent = projectNames[type];
      
      // Hide selection screen
      document.getElementById('selection-screen').style.display = 'none';
      
      // Show calculator screen - CRITICAL FIX
      const calculatorScreen = document.getElementById('calculator-screen');
      calculatorScreen.style.display = 'block';  // MUST set display block first
      calculatorScreen.classList.add('active');
      
      // Remove all theme classes first
      calculatorScreen.classList.remove('aerocon-theme', 'puff-theme', 'container-theme', 'shed-theme');
      
      // Add the specific project theme class
      calculatorScreen.classList.add(`${type}-theme`);
      
      updateInternalWalls();
      calculate();
    }
    
    function changeProject() {
      // Clear all inputs when changing project
      document.getElementById('length').value = '';
      document.getElementById('width').value = '';
      document.getElementById('height').value = '10';
      document.getElementById('num-doors').value = '0';
      document.getElementById('num-windows').value = '0';
      document.getElementById('num-internal-walls').value = '0';
      
      // Clear all checkboxes
      document.getElementById('opt-tiles').checked = false;
      document.getElementById('opt-false-ceiling').checked = false;
      document.getElementById('opt-false-floor').checked = false;
      document.getElementById('opt-insulation').checked = false;
      document.getElementById('opt-toilet').checked = false;
      document.getElementById('opt-kitchen').checked = false;
      document.getElementById('opt-cement-fiber').checked = false;
      
      // Clear internal walls
      document.getElementById('internal-walls-container').innerHTML = '';
      
      // Clear results
      document.getElementById('results-body').innerHTML = '';
      document.getElementById('results-mobile-cards').innerHTML = '';
      
      // Show selection screen
      document.getElementById('selection-screen').style.display = 'flex';
      const calculatorScreen = document.getElementById('calculator-screen');
      calculatorScreen.classList.remove('active');
      calculatorScreen.style.display = 'none';
      calculatorScreen.classList.remove('aerocon-theme', 'puff-theme', 'container-theme', 'shed-theme');
      
      currentProject = null;
      
      // Reset to default orange theme
      applyProjectTheme({
        primary: '#ff8a4c',
        secondary: '#ffad7a',
        gradient: 'linear-gradient(135deg, #ff8a4c 0%, #ffad7a 100%)'
      });
    }
    
    // Apply project-specific theme colors
    function applyProjectTheme(theme) {
      // Update all elements with primary color
      const primaryElements = [
        '.theme-toggle',
        '.project-type-btn',
        '.section-title',
        '.project-name',
        '.change-project-btn',
        '.action-btn',
        '.rate-input',
        '.internal-wall-entry label',
        'h1',
        '.selection-box h2',
        '.results-table th'
      ];
      
      primaryElements.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        elements.forEach(el => {
          el.style.setProperty('color', theme.primary, 'important');
        });
      });
      
      // Update gradient text elements
      const h1 = document.querySelector('h1');
      if (h1) {
        h1.style.background = theme.gradient;
        h1.style.webkitBackgroundClip = 'text';
        h1.style.webkitTextFillColor = 'transparent';
        h1.style.backgroundClip = 'text';
      }
      
      const h2 = document.querySelector('.selection-box h2');
      if (h2) {
        h2.style.background = theme.gradient;
        h2.style.webkitBackgroundClip = 'text';
        h2.style.webkitTextFillColor = 'transparent';
        h2.style.backgroundClip = 'text';
      }
      
      // Update borders
      const borderElements = document.querySelectorAll('.theme-toggle, .project-type-btn, .input-section, .project-header, .results-section, .rate-input, .change-project-btn, .action-btn');
      borderElements.forEach(el => {
        el.style.borderColor = `${theme.primary}40`;
      });
      
      // Update backgrounds with theme color
      const backgroundElements = document.querySelectorAll('.results-table thead, .theme-toggle, .change-project-btn, .action-btn');
      backgroundElements.forEach(el => {
        if (el.classList.contains('results-table')) {
          el.style.background = `${theme.primary}14`;
        } else {
          el.style.background = `${theme.primary}1a`;
        }
      });
      
      // Update SVG strokes
      const svgElements = document.querySelectorAll('.section-title svg, .project-name svg');
      svgElements.forEach(svg => {
        svg.style.stroke = theme.primary;
      });
      
      // Update focus and hover states dynamically
      const style = document.createElement('style');
      style.id = 'dynamic-theme-style';
      
      // Remove old dynamic style if exists
      const oldStyle = document.getElementById('dynamic-theme-style');
      if (oldStyle) oldStyle.remove();
      
      style.innerHTML = `
        .input-group input:focus,
        .rate-input:focus,
        .internal-wall-entry input:focus,
        select:focus {
          border-color: ${theme.primary} !important;
          box-shadow: 0 0 0 3px ${theme.primary}1a !important;
        }
        
        .project-type-btn:hover {
          border-color: ${theme.primary} !important;
          box-shadow: 0 12px 40px ${theme.primary}33 !important;
        }
        
        .theme-toggle:hover,
        .change-project-btn:hover,
        .action-btn:hover {
          background: ${theme.primary}33 !important;
          border-color: ${theme.primary} !important;
        }
        
        .toggle-label:hover {
          border-color: ${theme.primary}26 !important;
          background: ${theme.primary}0d !important;
        }
        
        .toggle-label input[type="checkbox"] {
          accent-color: ${theme.primary} !important;
        }
        
        .section-title {
          border-bottom-color: ${theme.primary}33 !important;
        }
        
        .results-table thead {
          border-bottom-color: ${theme.primary}33 !important;
        }
        
        .results-table tfoot td {
          border-top-color: ${theme.primary}33 !important;
        }
        
        .gst-row {
          background: ${theme.primary}14 !important;
          color: ${theme.primary} !important;
        }
        
        .grand-total-row {
          background: ${theme.primary}26 !important;
          color: ${theme.primary} !important;
        }
        
        .per-sqft-row {
          background: ${theme.secondary}14 !important;
          color: ${theme.secondary} !important;
        }
        
        .per-sqft-row-with-gst {
          background: ${theme.secondary}1f !important;
          color: ${theme.secondary} !important;
        }
        
        footer .powered-by {
          color: ${theme.primary} !important;
        }
        
        footer .contact {
          color: ${theme.secondary} !important;
        }
        
        .total-card.gst {
          background: ${theme.primary}14 !important;
          color: ${theme.primary} !important;
        }
        
        .total-card.grand {
          background: ${theme.primary}26 !important;
          color: ${theme.primary} !important;
        }
        
        .total-card.per-sqft {
          background: ${theme.secondary}14 !important;
          color: ${theme.secondary} !important;
        }
        
        .total-card.per-sqft-gst {
          background: ${theme.secondary}1f !important;
          color: ${theme.secondary} !important;
        }
      `;
      
      document.head.appendChild(style);
    }
    
    // Update internal walls inputs
    function updateInternalWalls() {
      const count = parseInt(document.getElementById('num-internal-walls').value) || 0;
      const container = document.getElementById('internal-walls-container');
      container.innerHTML = '';
      
      if (count > 0) {
        const unitLabel = currentUnit === 'feet' ? 'ft' : (currentUnit === 'mm' ? 'mm' : 'm');
        const helperText = document.createElement('small');
        helperText.style.color = '#6b7280';
        helperText.style.fontSize = '0.8125rem';
        helperText.style.display = 'block';
        helperText.style.marginBottom = '0.75rem';
        helperText.style.fontFamily = 'Inter, sans-serif';
        helperText.style.fontWeight = '400';
        helperText.textContent = `Enter length (${unitLabel}) for each internal wall:`;
        container.appendChild(helperText);
      }
      
      const stepSize = currentUnit === 'mm' ? '1' : '0.01';
      
      for (let i = 1; i <= count; i++) {
        const div = document.createElement('div');
        div.className = 'internal-wall-entry';
        div.innerHTML = `
          <label>Wall ${i}:</label>
          <input type="number" id="wall-${i}" step="${stepSize}" value="8" oninput="calculate()" placeholder="Enter length">
        `;
        container.appendChild(div);
      }
      
      calculate();
    }
    
    function updateInternalWallUnits(newUnit, stepSize) {
      const count = parseInt(document.getElementById('num-internal-walls').value) || 0;
      const decimalPlaces = newUnit === 'mm' ? 0 : 2;
      
      for (let i = 1; i <= count; i++) {
        const wallInput = document.getElementById(`wall-${i}`);
        if (wallInput) {
          const valueInFeet = convertToFeet(parseFloat(wallInput.value) || 0, currentUnit);
          wallInput.value = convertFromFeet(valueInFeet, newUnit).toFixed(decimalPlaces);
          wallInput.step = stepSize;
        }
      }
      
      // Update helper text
      if (count > 0) {
        const unitLabel = newUnit === 'feet' ? 'ft' : (newUnit === 'mm' ? 'mm' : 'm');
        const helperText = document.querySelector('#internal-walls-container small');
        if (helperText) {
          helperText.textContent = `Enter length (${unitLabel}) for each internal wall:`;
        }
      }
    }
    
    // Main calculation function
    function calculate() {
      if (!currentProject) return;
      
      // Get basic dimensions and convert to feet for calculation
      const length = convertToFeet(parseFloat(document.getElementById('length').value) || 0, currentUnit);
      const width = convertToFeet(parseFloat(document.getElementById('width').value) || 0, currentUnit);
      const height = convertToFeet(parseFloat(document.getElementById('height').value) || 0, currentUnit);
      
      // Get doors and windows (convert to feet)
      const numDoors = parseInt(document.getElementById('num-doors').value) || 0;
      const doorLength = convertToFeet(parseFloat(document.getElementById('door-length').value) || 0, currentUnit);
      const doorWidth = convertToFeet(parseFloat(document.getElementById('door-width').value) || 0, currentUnit);
      const numWindows = parseInt(document.getElementById('num-windows').value) || 0;
      const windowLength = convertToFeet(parseFloat(document.getElementById('window-length').value) || 0, currentUnit);
      const windowWidth = convertToFeet(parseFloat(document.getElementById('window-width').value) || 0, currentUnit);
      
      // Get internal walls (convert to feet)
      const numInternalWalls = parseInt(document.getElementById('num-internal-walls').value) || 0;
      let internalWallLength = 0;
      for (let i = 1; i <= numInternalWalls; i++) {
        const wallInput = document.getElementById(`wall-${i}`);
        if (wallInput) {
          const wallValue = convertToFeet(parseFloat(wallInput.value) || 0, currentUnit);
          internalWallLength += wallValue;
        }
      }
      
      // Calculate core areas
      const structureArea = length * width;
      const wallRunningFeet = (length * 2) + (width * 2);
      const wallArea = (wallRunningFeet + internalWallLength) * height;
      const roofArea = (length + 1) * (width + 1);
      const doorArea = numDoors * doorLength * doorWidth;
      const windowArea = numWindows * windowLength * windowWidth;
      const electricalArea = length * width;
      
      // Get display unit for results
      const displayUnit = currentUnit === 'feet' ? 'sq.ft' : (currentUnit === 'mm' ? 'sq.mm' : 'sq.m');
      const displayLinearUnit = currentUnit === 'feet' ? 'rft' : (currentUnit === 'mm' ? 'mm' : 'm');
      const decimalPlaces = currentUnit === 'mm' ? 0 : 2;
      
      // Convert areas back to display unit for showing in results
      const displayStructureArea = convertFromFeet(structureArea, currentUnit);
      const displayWallArea = convertFromFeet(wallArea, currentUnit);
      const displayRoofArea = convertFromFeet(roofArea, currentUnit);
      const displayDoorArea = convertFromFeet(doorArea, currentUnit);
      const displayWindowArea = convertFromFeet(windowArea, currentUnit);
      const displayElectricalArea = convertFromFeet(electricalArea, currentUnit);
      
      // Build results array
      const results = [];
      
      // Core components (always shown)
      results.push({
        name: 'Structure Area',
        quantity: displayStructureArea.toFixed(decimalPlaces),
        unit: displayUnit,
        rateId: 'rate-structure',
        defaultRate: ''
      });
      
      results.push({
        name: 'Wall Area',
        quantity: displayWallArea.toFixed(decimalPlaces),
        unit: displayUnit,
        rateId: 'rate-wall',
        defaultRate: ''
      });
      
      results.push({
        name: 'Roof Area',
        quantity: displayRoofArea.toFixed(decimalPlaces),
        unit: displayUnit,
        rateId: 'rate-roof',
        defaultRate: ''
      });
      
      if (numDoors > 0) {
        results.push({
          name: 'Door Area',
          quantity: displayDoorArea.toFixed(decimalPlaces),
          unit: displayUnit,
          rateId: 'rate-door',
          defaultRate: ''
        });
      }
      
      if (numWindows > 0) {
        results.push({
          name: 'Window Area',
          quantity: displayWindowArea.toFixed(decimalPlaces),
          unit: displayUnit,
          rateId: 'rate-window',
          defaultRate: ''
        });
      }
      
      results.push({
        name: 'Electrical Work Area',
        quantity: displayElectricalArea.toFixed(decimalPlaces),
        unit: displayUnit,
        rateId: 'rate-electrical',
        defaultRate: ''
      });
      
      // Optional components
      if (document.getElementById('opt-tiles').checked) {
        const tilesArea = structureArea + wallRunningFeet;
        const displayTilesArea = convertFromFeet(tilesArea, currentUnit);
        results.push({
          name: 'Tiles + Skirting',
          quantity: displayTilesArea.toFixed(decimalPlaces),
          unit: `${displayUnit} + ${displayLinearUnit}`,
          rateId: 'rate-tiles',
          defaultRate: ''
        });
      }
      
      if (document.getElementById('opt-false-ceiling').checked) {
        const falseCeilingArea = length * width;
        const displayFalseCeilingArea = convertFromFeet(falseCeilingArea, currentUnit);
        results.push({
          name: 'False Ceiling',
          quantity: displayFalseCeilingArea.toFixed(decimalPlaces),
          unit: displayUnit,
          rateId: 'rate-false-ceiling',
          defaultRate: ''
        });
      }
      
      if (document.getElementById('opt-false-floor').checked) {
        const falseFloorArea = length * width;
        const displayFalseFloorArea = convertFromFeet(falseFloorArea, currentUnit);
        results.push({
          name: 'False Floor',
          quantity: displayFalseFloorArea.toFixed(decimalPlaces),
          unit: displayUnit,
          rateId: 'rate-false-floor',
          defaultRate: ''
        });
      }
      
      if (document.getElementById('opt-insulation').checked) {
        const displayInsulationArea = convertFromFeet(roofArea, currentUnit);
        results.push({
          name: 'Insulation',
          quantity: displayInsulationArea.toFixed(decimalPlaces),
          unit: displayUnit,
          rateId: 'rate-insulation',
          defaultRate: ''
        });
      }
      
      if (document.getElementById('opt-toilet').checked) {
        results.push({
          name: 'Toilet Unit',
          quantity: '1',
          unit: 'unit',
          rateId: 'rate-toilet',
          defaultRate: ''
        });
      }
      
      if (document.getElementById('opt-kitchen').checked) {
        results.push({
          name: 'Kitchen',
          quantity: '1',
          unit: 'unit',
          rateId: 'rate-kitchen',
          defaultRate: ''
        });
      }
      
      if (document.getElementById('opt-cement-fiber').checked) {
        const cementFiberArea = wallRunningFeet * 10;
        const displayCementFiberArea = convertFromFeet(cementFiberArea, currentUnit);
        results.push({
          name: 'Cement Fiber Plank',
          quantity: displayCementFiberArea.toFixed(decimalPlaces),
          unit: displayUnit,
          rateId: 'rate-cement-fiber',
          defaultRate: ''
        });
      }
      
      // Render results table
      renderResults(results, structureArea);
    }
    
    // Store rates globally to persist them
    const rateStore = {};
    
    function renderResults(results, structureArea) {
      const tbody = document.getElementById('results-body');
      const mobileCards = document.getElementById('results-mobile-cards');
      tbody.innerHTML = '';
      mobileCards.innerHTML = '';
      
      let grandTotal = 0;
      
      results.forEach(item => {
        // Desktop table row
        const row = document.createElement('tr');
        
        // Get rate from store or use default (empty string for blank)
        const currentRate = rateStore[item.rateId] !== undefined ? rateStore[item.rateId] : item.defaultRate;
        
        const quantity = parseFloat(item.quantity);
        const rateValue = currentRate === '' ? 0 : parseFloat(currentRate);
        const amount = quantity * rateValue;
        grandTotal += amount;
        
        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.quantity} ${item.unit}</td>
          <td><input type="number" class="rate-input" data-rate-id="${item.rateId}" data-quantity="${quantity}" value="${currentRate}" step="0.01" placeholder="0"></td>
          <td class="amount-cell" data-amount-for="${item.rateId}">‚Çπ${amount.toFixed(2)}</td>
        `;
        
        tbody.appendChild(row);
        
        // Mobile card
        const card = document.createElement('div');
        card.className = 'result-card';
        card.innerHTML = `
          <div class="result-card-header">${item.name}</div>
          <div class="result-card-row">
            <span class="result-card-label">Quantity</span>
            <span class="result-card-value">${item.quantity} ${item.unit}</span>
          </div>
          <div class="result-card-row">
            <span class="result-card-label">Rate</span>
            <input type="number" class="rate-input" data-rate-id="${item.rateId}-mobile" data-quantity="${quantity}" value="${currentRate}" step="0.01" placeholder="0" inputmode="decimal">
          </div>
          <div class="result-card-row">
            <span class="result-card-label">Amount</span>
            <span class="result-card-value amount-cell" data-amount-for="${item.rateId}-mobile">‚Çπ${amount.toFixed(2)}</span>
          </div>
        `;
        
        mobileCards.appendChild(card);
      });
      
      // Add event listeners ONCE after all elements are rendered
      setTimeout(() => {
        attachRateInputListeners();
      }, 0);
      
      // Update totals (both desktop and mobile)
      updateTotals(grandTotal, structureArea);
    }
    
    // Attach event listeners to all rate inputs
    function attachRateInputListeners() {
      const allRateInputs = document.querySelectorAll('.rate-input[data-rate-id]');
      
      allRateInputs.forEach(input => {
        // Add input event listener
        input.addEventListener('input', function(e) {
          const rateId = this.getAttribute('data-rate-id');
          const baseRateId = rateId.replace('-mobile', '');
          const quantity = parseFloat(this.getAttribute('data-quantity')) || 0;
          const val = this.value;
          const rateValue = val === '' ? 0 : parseFloat(val) || 0;
          
          // Store the rate
          rateStore[baseRateId] = val;
          
          // Sync desktop and mobile inputs
          const desktopInput = document.querySelector(`.rate-input[data-rate-id="${baseRateId}"]`);
          const mobileInput = document.querySelector(`.rate-input[data-rate-id="${baseRateId}-mobile"]`);
          
          if (desktopInput && desktopInput !== this) desktopInput.value = val;
          if (mobileInput && mobileInput !== this) mobileInput.value = val;
          
          // Calculate amount for THIS row immediately
          const amount = quantity * rateValue;
          
          // Update THIS row's amount cells
          const desktopAmountCell = document.querySelector(`.amount-cell[data-amount-for="${baseRateId}"]`);
          const mobileAmountCell = document.querySelector(`.amount-cell[data-amount-for="${baseRateId}-mobile"]`);
          
          if (desktopAmountCell) {
            desktopAmountCell.textContent = `‚Çπ${amount.toFixed(2)}`;
          }
          if (mobileAmountCell) {
            mobileAmountCell.textContent = `‚Çπ${amount.toFixed(2)}`;
          }
          
          // Recalculate totals
          calculateTotalsOnly();
        });
      });
    }
    
    function updateTotals(grandTotal, structureArea) {
      const gstAmount = grandTotal * 0.18;
      const totalWithGst = grandTotal + gstAmount;
      const perSqftCostWithoutGst = structureArea > 0 ? grandTotal / structureArea : 0;
      const perSqftCostWithGst = structureArea > 0 ? totalWithGst / structureArea : 0;
      
      // Desktop totals
      document.getElementById('subtotal').textContent = `‚Çπ${grandTotal.toFixed(2)}`;
      document.getElementById('gst-amount').textContent = `‚Çπ${gstAmount.toFixed(2)}`;
      document.getElementById('grand-total').textContent = `‚Çπ${totalWithGst.toFixed(2)}`;
      document.getElementById('per-sqft-cost-without-gst').textContent = `‚Çπ${perSqftCostWithoutGst.toFixed(2)}`;
      document.getElementById('per-sqft-cost').textContent = `‚Çπ${perSqftCostWithGst.toFixed(2)}`;
      
      // Mobile totals
      document.getElementById('subtotal-mobile').textContent = `‚Çπ${grandTotal.toFixed(2)}`;
      document.getElementById('gst-amount-mobile').textContent = `‚Çπ${gstAmount.toFixed(2)}`;
      document.getElementById('grand-total-mobile').textContent = `‚Çπ${totalWithGst.toFixed(2)}`;
      document.getElementById('per-sqft-cost-without-gst-mobile').textContent = `‚Çπ${perSqftCostWithoutGst.toFixed(2)}`;
      document.getElementById('per-sqft-cost-mobile').textContent = `‚Çπ${perSqftCostWithGst.toFixed(2)}`;
    }
    
    // Calculate ONLY totals from existing amounts (don't rebuild table or recalculate rows)
    function calculateTotalsOnly() {
      let grandTotal = 0;
      
      // Sum all desktop amount cells
      const desktopAmountCells = document.querySelectorAll('.amount-cell[data-amount-for]:not([data-amount-for*="-mobile"])');
      desktopAmountCells.forEach(cell => {
        const amountText = cell.textContent.replace('‚Çπ', '').replace(',', '').trim();
        const amount = parseFloat(amountText) || 0;
        grandTotal += amount;
      });
      
      const length = convertToFeet(parseFloat(document.getElementById('length').value) || 0, currentUnit);
      const width = convertToFeet(parseFloat(document.getElementById('width').value) || 0, currentUnit);
      const structureArea = length * width;
      
      // Update totals (both desktop and mobile)
      updateTotals(grandTotal, structureArea);
    }
    
    // Clear all rates function
    function clearAllRates() {
      // Clear all rate inputs - both desktop and mobile
      const allRateInputs = document.querySelectorAll('.rate-input[data-rate-id]');
      allRateInputs.forEach(input => {
        input.value = '';
        const rateId = input.getAttribute('data-rate-id');
        const baseRateId = rateId.replace('-mobile', '');
        rateStore[baseRateId] = '';
      });
      
      // Recalculate to update all amounts to zero
      calculateFromRates();
    }
    
    // Initialize
    initElementSdk();
    
    // Theme toggle functionality
    function toggleTheme() {
      const body = document.body;
      const sunIcon = document.getElementById('sun-icon');
      const moonIcon = document.getElementById('moon-icon');
      const themeText = document.getElementById('theme-text');
      
      body.classList.toggle('light-mode');
      
      if (body.classList.contains('light-mode')) {
        sunIcon.style.display = 'none';
        moonIcon.style.display = 'block';
        themeText.textContent = 'Dark';
        localStorage.setItem('theme', 'light');
      } else {
        sunIcon.style.display = 'block';
        moonIcon.style.display = 'none';
        themeText.textContent = 'Light';
        localStorage.setItem('theme', 'dark');
      }
    }
    
    // Load saved theme on page load
    window.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.body.classList.add('light-mode');
        document.getElementById('sun-icon').style.display = 'none';
        document.getElementById('moon-icon').style.display = 'block';
        document.getElementById('theme-text').textContent = 'Dark';
      }
    });
    
    // Print functionality
    function printCalculation() {
      const printWindow = window.open('', '', 'width=800,height=600');
      const today = new Date().toLocaleDateString('en-IN', { year: 'numeric', month: 'long', day: 'numeric' });
      
      let tableRows = '';
      let grandTotal = 0;
      
      const rows = document.getElementById('results-body').querySelectorAll('tr');
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        const componentName = cells[0].textContent.trim();
        const quantity = cells[1].textContent.trim();
        const rateInput = cells[2].querySelector('input');
        const rate = rateInput.value || '0';
        const amount = cells[3].textContent.trim();
        
        // Only include rows where rate is entered (not empty or 0)
        const rateValue = parseFloat(rate);
        if (rateValue > 0) {
          tableRows += '<tr>';
          tableRows += '<td>' + componentName + '</td>';
          tableRows += '<td style="text-align: center;">' + quantity + '</td>';
          tableRows += '<td style="text-align: right;">‚Çπ' + rate + '</td>';
          tableRows += '<td style="text-align: right;">' + amount + '</td>';
          tableRows += '</tr>';
          
          const amountValue = parseFloat(amount.replace('‚Çπ', '').replace(',', '')) || 0;
          grandTotal += amountValue;
        }
      });
      
      const gstAmount = grandTotal * 0.18;
      const totalWithGst = grandTotal + gstAmount;
      
      const length = convertToFeet(parseFloat(document.getElementById('length').value) || 0, currentUnit);
      const width = convertToFeet(parseFloat(document.getElementById('width').value) || 0, currentUnit);
      const structureArea = length * width;
      const perSqftCostWithoutGst = structureArea > 0 ? grandTotal / structureArea : 0;
      const perSqftCostWithGst = structureArea > 0 ? totalWithGst / structureArea : 0;
      
      let htmlContent = '<!DOCTYPE html><html><head><title>Quotation - Contrive Interior & Construction</title>';
      htmlContent += '<style>* { margin: 0; padding: 0; box-sizing: border-box; }';
      htmlContent += 'body { font-family: Arial, sans-serif; padding: 30px; background: white; color: #333; }';
      htmlContent += '.header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid #ff8a4c; padding-bottom: 15px; }';
      htmlContent += '.header h1 { font-size: 24px; color: #ff8a4c; margin-bottom: 5px; font-weight: 700; }';
      htmlContent += '.header h2 { font-size: 18px; color: #666; margin-bottom: 10px; font-weight: 600; }';
      htmlContent += '.header p { font-size: 12px; color: #888; }';
      htmlContent += 'table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 11px; }';
      htmlContent += 'th, td { border: 1px solid #333; padding: 8px; }';
      htmlContent += 'th { background: #f5f5f5; font-weight: 600; text-align: left; }';
      htmlContent += '.totals { margin-top: 10px; font-size: 12px; }';
      htmlContent += '.totals tr td:first-child { font-weight: 600; text-align: right; padding-right: 20px; }';
      htmlContent += '.totals tr td:last-child { text-align: right; font-weight: 600; }';
      htmlContent += '.gst-row { background: #ffe8dc !important; }';
      htmlContent += '.grand-total-row { background: #ffd4bf !important; font-size: 14px !important; font-weight: 700 !important; }';
      htmlContent += '.per-sqft-row { background: #fff5ed !important; }';
      htmlContent += '.footer { margin-top: 40px; text-align: center; font-size: 11px; color: #666; border-top: 1px solid #ddd; padding-top: 15px; }';
      htmlContent += '</style></head><body>';
      htmlContent += '<div class="header"><h1>Contrive Interior & Construction</h1><h2>Quotation - ' + (currentProject ? currentProject.name : 'Project') + '</h2><p>Date: ' + today + '</p></div>';
      htmlContent += '<table><thead><tr><th>Component</th><th style="text-align: center;">Quantity</th>';
      htmlContent += '<th style="text-align: right;">Rate</th><th style="text-align: right;">Amount</th></tr></thead>';
      htmlContent += '<tbody>' + tableRows + '</tbody></table>';
      htmlContent += '<table class="totals"><tr><td>Subtotal (Without GST):</td><td>‚Çπ' + grandTotal.toFixed(2) + '</td></tr>';
      htmlContent += '<tr class="gst-row"><td>GST @18%:</td><td>‚Çπ' + gstAmount.toFixed(2) + '</td></tr>';
      htmlContent += '<tr class="grand-total-row"><td>Grand Total (With GST):</td><td>‚Çπ' + totalWithGst.toFixed(2) + '</td></tr>';
      htmlContent += '<tr class="per-sqft-row"><td>Per Sq.Ft Cost (Without GST):</td><td>‚Çπ' + perSqftCostWithoutGst.toFixed(2) + '</td></tr>';
      htmlContent += '<tr class="per-sqft-row"><td>Per Sq.Ft Cost (With GST):</td><td>‚Çπ' + perSqftCostWithGst.toFixed(2) + '</td></tr></table>';
      htmlContent += '<div class="footer"><p><strong>Powered by Afjal Ali</strong></p><p>Contact: +91-9452137890</p></div>';
      htmlContent += '<script>window.onload = function() { window.print(); window.onafterprint = function() { window.close(); }; };<\/script>';
      htmlContent += '</body></html>';
      
      printWindow.document.write(htmlContent);
      printWindow.document.close();
    }
    
    // PDF Download functionality
    function downloadPDF() {
      // Create a printable view message
      const message = document.createElement('div');
      message.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #252932 0%, #1a1d29 100%);
        color: #e8eaed;
        padding: 2rem;
        border-radius: 16px;
        border: 2px solid #ff8a4c;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        z-index: 10000;
        text-align: center;
        font-family: 'Inter', sans-serif;
        max-width: 90%;
      `;
      
      message.innerHTML = `
        <div style="font-size: 1.25rem; font-weight: 600; color: #ff8a4c; margin-bottom: 1rem; font-family: 'Manrope', sans-serif;">
              Save as PDF
        </div>
        <div style="font-size: 0.9375rem; line-height: 1.6; margin-bottom: 1.5rem;">
          To save this calculation as PDF:<br><br>
          1. Click "Print" button or press <strong>Ctrl+P</strong> (Windows) / <strong>Cmd+P</strong> (Mac)<br>
          2. In print dialog, select <strong>"Save as PDF"</strong> as destination<br>
          3. Click <strong>"Save"</strong> and choose location
        </div>
        <button type="button" onclick="this.parentElement.remove(); window.print();" style="
          background: #ff8a4c;
          color: white;
          border: none;
          padding: 0.75rem 1.5rem;
          border-radius: 8px;
          cursor: none;
          font-family: 'Inter', sans-serif;
          font-weight: 500;
          font-size: 0.875rem;
          margin-right: 0.5rem;
        ">Open Print Dialog</button>
        <button type="button" onclick="this.parentElement.remove()" style="
          background: rgba(255, 138, 76, 0.1);
          color: #ff8a4c;
          border: 1px solid rgba(255, 138, 76, 0.3);
          padding: 0.75rem 1.5rem;
          border-radius: 8px;
          cursor: none;
          font-family: 'Inter', sans-serif;
          font-weight: 500;
          font-size: 0.875rem;
        ">Close</button>
      `;
      
      document.body.appendChild(message);
    }
    
    // Material Specification Module
    const materialSpecData = [
      { name: 'MS Pipe 25√ó25', size: '25√ó25', thickness: null, defaultWeight: 7, showThickness: false },
      { name: 'MS Pipe 40√ó40', size: '40√ó40', thickness: 2.0, defaultWeight: 14, showThickness: true },
      { name: 'MS Pipe 40√ó80', size: '40√ó80', thickness: 2.2, defaultWeight: 23, showThickness: true },
      { name: 'MS Pipe 50√ó100', size: '50√ó100', thickness: 2.5, defaultWeight: 34, showThickness: true },
      { name: 'MS Pipe 100√ó100', size: '100√ó100', thickness: 3.0, defaultWeight: 40, showThickness: true },
      { name: 'MS Pipe 100√ó150', size: '100√ó150', thickness: 3.0, defaultWeight: 50, showThickness: true },
      { name: 'MS Pipe 150√ó150', size: '150√ó150', thickness: 3.5, defaultWeight: 70, showThickness: true },
      { name: 'C Channel', size: '5 Inch (ISMC 125)', thickness: 2.5, defaultWeight: 28, showThickness: true },
      { name: 'C Channel', size: '5 Inch (ISMC 125)', thickness: 5.0, defaultWeight: 28, showThickness: true }
    ];
    
    const materialRateStore = {};
    
    function openMaterialSpec() {
      // Hide selection and calculator screens
      document.getElementById('selection-screen').style.display = 'none';
      const calcScreen = document.getElementById('calculator-screen');
      if (calcScreen) {
        calcScreen.classList.remove('active');
        calcScreen.style.display = 'none';
      }
      
      // Show material spec screen
      const materialScreen = document.getElementById('material-spec-screen');
      materialScreen.style.display = 'block';
      
      // Apply cyan theme for material spec
      applyProjectTheme({
        primary: '#05EAF2',
        secondary: '#04c9d1',
        gradient: 'linear-gradient(135deg, #05EAF2 0%, #04c9d1 100%)'
      });
      
      // Initialize material spec table
      initMaterialSpec();
    }
    
    function closeMaterialSpec() {
      // Hide material spec screen
      document.getElementById('material-spec-screen').style.display = 'none';
      
      // Show calculator screen if project was selected, otherwise show selection
      if (currentProject) {
        const calculatorScreen = document.getElementById('calculator-screen');
        calculatorScreen.style.display = 'block';
        calculatorScreen.classList.add('active');
        
        // Restore project-specific theme
        applyProjectTheme(currentProject.theme);
      } else {
        document.getElementById('selection-screen').style.display = 'flex';
        
        // Reset to default orange theme
        applyProjectTheme({
          primary: '#ff8a4c',
          secondary: '#ffad7a',
          gradient: 'linear-gradient(135deg, #ff8a4c 0%, #ffad7a 100%)'
        });
      }
    }
    
    function initMaterialSpec() {
      // Just render the table - it will be empty initially until user selects materials
      updateMaterialSpecTable();
    }
    
    function updateMaterialSpecTable() {
      const tbody = document.getElementById('material-spec-body');
      const mobileCards = document.getElementById('material-spec-mobile-cards');
      tbody.innerHTML = '';
      mobileCards.innerHTML = '';
      
      let rowCount = 0;
      
      materialSpecData.forEach((material, index) => {
        const checkbox = document.getElementById(`pipe-select-${index}`);
        
        // Only show row if checkbox is ticked
        if (!checkbox || !checkbox.checked) {
          return;
        }
        
        const thicknessId = `ms-thickness-${index}`;
        const qtyId = `ms-qty-${index}`;
        const weightId = `ms-weight-${index}`;
        const rateId = `ms-rate-${index}`;
        
        // Get stored values or use defaults
        const storedThickness = materialRateStore[thicknessId] !== undefined ? materialRateStore[thicknessId] : (material.thickness || '');
        const storedQty = materialRateStore[qtyId] || '';
        const storedWeight = materialRateStore[weightId] !== undefined ? materialRateStore[weightId] : material.defaultWeight;
        const storedRate = materialRateStore[rateId] || '';
        
        // Desktop table row
        const row = document.createElement('tr');
        
        const thicknessCell = material.showThickness 
          ? `<td><input type="number" class="rate-input ms-input" id="${thicknessId}" data-ms-id="${thicknessId}" data-index="${index}" value="${storedThickness}" step="0.1" placeholder="0" style="width: 80px;"></td>`
          : `<td style="text-align: center; color: #6b7280;">‚Äî</td>`;
        
        row.innerHTML = `
          <td style="font-weight: 500;">${material.name}</td>
          <td>${material.size}</td>
          ${thicknessCell}
          <td><input type="number" class="rate-input ms-input" id="${qtyId}" data-ms-id="${qtyId}" data-index="${index}" value="${storedQty}" step="1" placeholder="0" style="width: 80px;"></td>
          <td><input type="number" class="rate-input ms-input" id="${weightId}" data-ms-id="${weightId}" data-index="${index}" value="${storedWeight}" step="0.1" placeholder="0" style="width: 90px;"></td>
          <td id="total-weight-${index}">0.00 kg</td>
          <td><input type="number" class="rate-input ms-input" id="${rateId}" data-ms-id="${rateId}" data-index="${index}" value="${storedRate}" step="0.01" placeholder="0" style="width: 100px;"></td>
          <td id="amount-${index}">‚Çπ0.00</td>
        `;
        tbody.appendChild(row);
        
        // Mobile card
        const card = document.createElement('div');
        card.className = 'result-card';
        
        const thicknessRow = material.showThickness 
          ? `<div class="result-card-row">
              <span class="result-card-label">Thickness (mm)</span>
              <input type="number" class="rate-input ms-input" data-ms-id="${thicknessId}" data-index="${index}" value="${storedThickness}" step="0.1" placeholder="0">
            </div>`
          : '';
        
        card.innerHTML = `
          <div class="result-card-header">${material.name} (${material.size})</div>
          ${thicknessRow}
          <div class="result-card-row">
            <span class="result-card-label">Qty (Pieces - 20ft)</span>
            <input type="number" class="rate-input ms-input" data-ms-id="${qtyId}" data-index="${index}" value="${storedQty}" step="1" placeholder="0">
          </div>
          <div class="result-card-row">
            <span class="result-card-label">Weight per Piece (kg)</span>
            <input type="number" class="rate-input ms-input" data-ms-id="${weightId}" data-index="${index}" value="${storedWeight}" step="0.1" placeholder="0">
          </div>
          <div class="result-card-row">
            <span class="result-card-label">Total Weight</span>
            <span class="result-card-value" id="total-weight-${index}-mobile">0.00 kg</span>
          </div>
          <div class="result-card-row">
            <span class="result-card-label">Rate (‚Çπ/kg)</span>
            <input type="number" class="rate-input ms-input" data-ms-id="${rateId}" data-index="${index}" value="${storedRate}" step="0.01" placeholder="0">
          </div>
          <div class="result-card-row">
            <span class="result-card-label">Amount</span>
            <span class="result-card-value" id="amount-${index}-mobile">‚Çπ0.00</span>
          </div>
        `;
        mobileCards.appendChild(card);
        
        rowCount++;
      });
      
      // Show message if no materials selected
      if (rowCount === 0) {
        const emptyRow = document.createElement('tr');
        emptyRow.innerHTML = `
          <td colspan="8" style="text-align: center; padding: 2rem; color: #6b7280; font-style: italic;">
            ‚¨ÜÔ∏è Please select materials from above to start calculation
          </td>
        `;
        tbody.appendChild(emptyRow);
        
        const emptyCard = document.createElement('div');
        emptyCard.style.cssText = 'text-align: center; padding: 2rem; color: #6b7280; font-style: italic; grid-column: 1 / -1;';
        emptyCard.textContent = '‚¨ÜÔ∏è Please select materials from above to start calculation';
        mobileCards.appendChild(emptyCard);
      }
      
      // Attach event listeners ONCE after all inputs are created
      setTimeout(() => {
        attachMaterialSpecListeners();
      }, 0);
      
      // Initial calculation
      calculateMaterialSpec();
    }
    
    // Separate function to attach listeners to material spec inputs
    function attachMaterialSpecListeners() {
      const allMsInputs = document.querySelectorAll('.ms-input[data-ms-id]');
      
      allMsInputs.forEach(input => {
        input.addEventListener('input', function() {
          const msId = this.getAttribute('data-ms-id');
          const value = this.value;
          
          // Store the value
          materialRateStore[msId] = value;
          
          // Sync all inputs with same data-ms-id (desktop and mobile)
          const allSameInputs = document.querySelectorAll(`.ms-input[data-ms-id="${msId}"]`);
          allSameInputs.forEach(syncInput => {
            if (syncInput !== this) {
              syncInput.value = value;
            }
          });
          
          // Recalculate immediately
          calculateMaterialSpec();
        });
      });
    }
    
    function calculateMaterialSpec() {
      const gstIncluded = document.getElementById('gst-included').checked;
      let totalWeight = 0;
      let subtotal = 0;
      
      materialSpecData.forEach((material, index) => {
        const qtyId = `ms-qty-${index}`;
        const weightId = `ms-weight-${index}`;
        const rateId = `ms-rate-${index}`;
        
        // Get values from DOM inputs directly
        const qtyInput = document.getElementById(qtyId);
        const weightInput = document.getElementById(weightId);
        const rateInput = document.getElementById(rateId);
        
        const qty = parseFloat(qtyInput ? qtyInput.value : 0) || 0;
        const weightPerPiece = parseFloat(weightInput ? weightInput.value : material.defaultWeight) || 0;
        const ratePerKg = parseFloat(rateInput ? rateInput.value : 0) || 0;
        
        // Calculate total weight
        const weight = qty * weightPerPiece;
        totalWeight += weight;
        
        // Direct calculation: Weight √ó Rate
        const amount = weight * ratePerKg;
        subtotal += amount;
        
        // Update desktop display
        const desktopWeightCell = document.getElementById(`total-weight-${index}`);
        const desktopAmountCell = document.getElementById(`amount-${index}`);
        if (desktopWeightCell) desktopWeightCell.textContent = `${weight.toFixed(2)} kg`;
        if (desktopAmountCell) desktopAmountCell.textContent = `‚Çπ${amount.toFixed(2)}`;
        
        // Update mobile display
        const mobileWeight = document.getElementById(`total-weight-${index}-mobile`);
        const mobileAmount = document.getElementById(`amount-${index}-mobile`);
        if (mobileWeight) mobileWeight.textContent = `${weight.toFixed(2)} kg`;
        if (mobileAmount) mobileAmount.textContent = `‚Çπ${amount.toFixed(2)}`;
      });
      
      // Calculate based on GST checkbox
      let gstAmount, grandTotal;
      
      if (gstIncluded) {
        // GST is INCLUDED in subtotal - no additional GST to add
        gstAmount = subtotal * (18 / 118); // Extract GST component
        grandTotal = subtotal; // Grand total = subtotal (already includes GST)
      } else {
        // GST is NOT included - add 18% GST
        gstAmount = subtotal * 0.18;
        grandTotal = subtotal + gstAmount;
      }
      
      // Update desktop totals
      const totalWeightElem = document.getElementById('total-weight');
      const subtotalElem = document.getElementById('material-subtotal');
      const subtotalLabel = document.querySelector('.material-spec-table tfoot tr:nth-child(2) td:first-child');
      const gstElem = document.getElementById('material-gst-amount');
      const gstLabel = document.querySelector('.material-spec-table tfoot tr:nth-child(3) td:first-child');
      const grandTotalElem = document.getElementById('material-grand-total');
      
      if (totalWeightElem) totalWeightElem.textContent = `${totalWeight.toFixed(2)} kg`;
      if (subtotalElem) subtotalElem.textContent = `‚Çπ${subtotal.toFixed(2)}`;
      if (subtotalLabel) subtotalLabel.textContent = gstIncluded ? 'Subtotal (With GST)' : 'Subtotal (Without GST)';
      if (gstElem) gstElem.textContent = `‚Çπ${gstAmount.toFixed(2)}`;
      if (gstLabel) gstLabel.textContent = gstIncluded ? 'GST @18% (Included)' : 'GST @18%';
      if (grandTotalElem) grandTotalElem.textContent = `‚Çπ${grandTotal.toFixed(2)}`;
      
      // Update mobile totals
      const totalWeightMobile = document.getElementById('total-weight-mobile');
      const subtotalMobile = document.getElementById('material-subtotal-mobile');
      const subtotalLabelMobile = document.querySelector('#material-spec-screen .total-card.subtotal .total-card-label');
      const gstMobile = document.getElementById('material-gst-amount-mobile');
      const gstLabelMobile = document.querySelector('#material-spec-screen .total-card.gst .total-card-label');
      const grandTotalMobile = document.getElementById('material-grand-total-mobile');
      
      if (totalWeightMobile) totalWeightMobile.textContent = `${totalWeight.toFixed(2)} kg`;
      if (subtotalMobile) subtotalMobile.textContent = `‚Çπ${subtotal.toFixed(2)}`;
      if (subtotalLabelMobile) subtotalLabelMobile.textContent = gstIncluded ? 'Subtotal (With GST)' : 'Subtotal (Without GST)';
      if (gstMobile) gstMobile.textContent = `‚Çπ${gstAmount.toFixed(2)}`;
      if (gstLabelMobile) gstLabelMobile.textContent = gstIncluded ? 'GST @18% (Included)' : 'GST @18%';
      if (grandTotalMobile) grandTotalMobile.textContent = `‚Çπ${grandTotal.toFixed(2)}`;
    }
    
    function clearMaterialSpec() {
      // Clear all material spec inputs
      materialSpecData.forEach((material, index) => {
        const thicknessId = `ms-thickness-${index}`;
        const qtyId = `ms-qty-${index}`;
        const weightId = `ms-weight-${index}`;
        const rateId = `ms-rate-${index}`;
        
        // Clear from store
        delete materialRateStore[thicknessId];
        delete materialRateStore[qtyId];
        materialRateStore[weightId] = material.defaultWeight; // Reset to default weight
        delete materialRateStore[rateId];
        
        // Clear desktop inputs
        const thicknessInput = document.getElementById(thicknessId);
        const qtyInput = document.getElementById(qtyId);
        const weightInput = document.getElementById(weightId);
        const rateInput = document.getElementById(rateId);
        
        if (thicknessInput) thicknessInput.value = material.thickness || '';
        if (qtyInput) qtyInput.value = '';
        if (weightInput) weightInput.value = material.defaultWeight;
        if (rateInput) rateInput.value = '';
        
        // Clear mobile inputs
        const thicknessMobile = document.getElementById(`${thicknessId}-mobile`);
        const qtyMobile = document.getElementById(`${qtyId}-mobile`);
        const weightMobile = document.getElementById(`${weightId}-mobile`);
        const rateMobile = document.getElementById(`${rateId}-mobile`);
        
        if (thicknessMobile) thicknessMobile.value = material.thickness || '';
        if (qtyMobile) qtyMobile.value = '';
        if (weightMobile) weightMobile.value = material.defaultWeight;
        if (rateMobile) rateMobile.value = '';
      });
      
      // Recalculate to reset all totals
      calculateMaterialSpec();
    }
    
    function printMaterialSpec() {
      const printWindow = window.open('', '', 'width=800,height=600');
      const today = new Date().toLocaleDateString('en-IN', { year: 'numeric', month: 'long', day: 'numeric' });
      
      let tableRows = '';
      let totalWeight = 0;
      let subtotalWithoutGst = 0;
      
      materialSpecData.forEach((material, index) => {
        const qtyId = 'ms-qty-' + index;
        const weightId = 'ms-weight-' + index;
        const rateId = 'ms-rate-' + index;
        const thicknessId = 'ms-thickness-' + index;
        
        const qty = parseFloat(materialRateStore[qtyId] || 0);
        const weightPerPiece = parseFloat(materialRateStore[weightId] !== undefined ? materialRateStore[weightId] : material.defaultWeight);
        const ratePerKg = parseFloat(materialRateStore[rateId] || 0);
        const thickness = material.showThickness ? (materialRateStore[thicknessId] || material.thickness || '   ') : '‚Äî';
        
        const weight = qty * weightPerPiece;
        
        const gstIncluded = document.getElementById('gst-included').checked;
        let amount;
        
        if (gstIncluded) {
          const baseRatePerKg = ratePerKg / 1.18;
          amount = weight * baseRatePerKg;
        } else {
          amount = weight * ratePerKg;
        }
        
        // Only include rows where quantity and rate are entered
        if (qty > 0 && ratePerKg > 0) {
          totalWeight += weight;
          subtotalWithoutGst += amount;
          
          tableRows += '<tr>';
          tableRows += '<td>' + material.name + '</td>';
          tableRows += '<td style="text-align: center;">' + material.size + '</td>';
          tableRows += '<td style="text-align: center;">' + thickness + '</td>';
          tableRows += '<td style="text-align: center;">' + qty + '</td>';
          tableRows += '<td style="text-align: right;">' + weightPerPiece.toFixed(2) + ' kg</td>';
          tableRows += '<td style="text-align: right;">' + weight.toFixed(2) + ' kg</td>';
          tableRows += '<td style="text-align: right;">‚Çπ' + ratePerKg.toFixed(2) + '</td>';
          tableRows += '<td style="text-align: right;">‚Çπ' + amount.toFixed(2) + '</td>';
          tableRows += '</tr>';
        }
      });
      
      const gstAmount = subtotalWithoutGst * 0.18;
      const grandTotal = subtotalWithoutGst + gstAmount;
      
      let htmlContent = '<!DOCTYPE html><html><head><title>Material Specification - Contrive Interior & Construction</title>';
      htmlContent += '<style>* { margin: 0; padding: 0; box-sizing: border-box; }';
      htmlContent += 'body { font-family: Arial, sans-serif; padding: 30px; background: white; color: #333; }';
      htmlContent += '.header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid #ff8a4c; padding-bottom: 15px; }';
      htmlContent += '.header h1 { font-size: 24px; color: #ff8a4c; margin-bottom: 5px; font-weight: 700; }';
      htmlContent += '.header h2 { font-size: 18px; color: #666; margin-bottom: 10px; font-weight: 600; }';
      htmlContent += '.header p { font-size: 12px; color: #888; }';
      htmlContent += 'table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 11px; }';
      htmlContent += 'th, td { border: 1px solid #333; padding: 8px; }';
      htmlContent += 'th { background: #f5f5f5; font-weight: 600; text-align: left; }';
      htmlContent += '.totals { margin-top: 10px; font-size: 12px; }';
      htmlContent += '.totals tr td:first-child { font-weight: 600; text-align: right; padding-right: 20px; }';
      htmlContent += '.totals tr td:last-child { text-align: right; font-weight: 600; }';
      htmlContent += '.gst-row { background: #ffe8dc !important; }';
      htmlContent += '.grand-total-row { background: #ffd4bf !important; font-size: 14px !important; font-weight: 700 !important; }';
      htmlContent += '.footer { margin-top: 40px; text-align: center; font-size: 11px; color: #666; border-top: 1px solid #ddd; padding-top: 15px; }';
      htmlContent += '</style></head><body>';
      htmlContent += '<div class="header"><h1>Contrive Interior & Construction</h1><h2>Material Specification (M.S.)</h2><p>Date: ' + today + '</p></div>';
      htmlContent += '<table><thead><tr><th>Material Component</th><th style="text-align: center;">Size</th>';
      htmlContent += '<th style="text-align: center;">Thickness (mm)</th><th style="text-align: center;">Qty (Pieces - 20ft)</th>';
      htmlContent += '<th style="text-align: right;">Weight/Piece (kg)</th><th style="text-align: right;">Total Weight (kg)</th>';
      htmlContent += '<th style="text-align: right;">Rate (‚Çπ/kg)</th><th style="text-align: right;">Amount (‚Çπ)</th></tr></thead>';
      htmlContent += '<tbody>' + tableRows + '</tbody></table>';
      htmlContent += '<table class="totals"><tr><td>Total Material Weight:</td><td>' + totalWeight.toFixed(2) + ' kg</td></tr>';
      htmlContent += '<tr><td>Subtotal (Material Cost):</td><td>‚Çπ' + subtotalWithoutGst.toFixed(2) + '</td></tr>';
      htmlContent += '<tr class="gst-row"><td>GST @18%:</td><td>‚Çπ' + gstAmount.toFixed(2) + '</td></tr>';
      htmlContent += '<tr class="grand-total-row"><td>Grand Total (With GST):</td><td>‚Çπ' + grandTotal.toFixed(2) + '</td></tr></table>';
      htmlContent += '<div class="footer"><p><strong>Powered by Afjal Ali</strong></p><p>Contact: +91-9452137890</p></div>';
      htmlContent += '<script>window.onload = function() { window.print(); window.onafterprint = function() { window.close(); }; };<\/script>';
      htmlContent += '</body></html>';
      
      printWindow.document.write(htmlContent);
      printWindow.document.close();
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c27410bc1637f97',t:'MTc2OTE3MDkyMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
